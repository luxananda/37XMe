<!DOCTYPE html>
<!--
================================================================================
    37x Me Simple - Your Personal Growth Tracker
    Version: 3.0.0 (Standalone Edition)
    
    Copyright (c) 2026 Lakshmi Venkatesh. All Rights Reserved.
    
    USAGE: Just download and open this single HTML file in your browser!
    - Data is stored in browser localStorage (as JSON)
    - Use Export to backup your data to a JSON file
    - Use Import to restore from a backup
    - Works 100% offline once loaded
================================================================================
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>37x Me | Simple Growth Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg-primary: #fdfcfa;
            --bg-secondary: #f8f6f3;
            --bg-card: rgba(255, 255, 255, 0.85);
            --text-primary: #3d3a36;
            --text-secondary: #6b6560;
            --text-muted: #a39e97;
            --accent-sage: #9caf88;
            --accent-lavender: #b8a9c9;
            --accent-gold: #c9a86c;
            --accent-dusty: #c9b1a0;
            --success: #7d9b76;
            --warning: #c9a86c;
            --danger: #d4a5a5;
            --shadow-soft: 0 4px 20px rgba(0,0,0,0.04);
            --shadow-medium: 0 8px 30px rgba(0,0,0,0.06);
            --radius-sm: 12px;
            --radius-md: 16px;
            --radius-lg: 24px;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.7;
            min-height: 100vh;
        }
        
        h1, h2, h3 { font-family: Georgia, 'Times New Roman', serif; font-weight: 500; }
        
        .watercolor-bg {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none; z-index: 0; overflow: hidden;
        }
        .watercolor-blob {
            position: absolute; opacity: 0.4; filter: blur(40px);
            animation: float 20s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(-5px, 5px) rotate(-1deg); }
        }
        
        /* Celebration Animations */
        @keyframes firework {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        @keyframes sparkle {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.3) rotate(180deg); opacity: 0.7; }
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(201, 168, 108, 0.3); }
            50% { box-shadow: 0 0 20px rgba(201, 168, 108, 0.6); }
        }
        @keyframes confetti-fall {
            0% { transform: translateY(-100%) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        @keyframes star-spin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); }
        }
        
        /* Firework Overlay */
        .firework-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }
        .firework-particle {
            position: absolute;
            width: 10px; height: 10px;
            border-radius: 50%;
            animation: firework 1.5s ease-out forwards;
        }
        .confetti {
            position: absolute;
            width: 10px; height: 10px;
            animation: confetti-fall 3s ease-in forwards;
        }
        
        /* Reward Badges */
        .reward-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            animation: bounce 1s ease-in-out infinite;
        }
        .reward-badge.star { animation: star-spin 2s linear infinite; }
        .reward-badge.trophy { animation: pulse-glow 2s ease-in-out infinite; }
        
        /* Milestone Cell with Reward */
        .milestone-cell-reward {
            position: absolute;
            top: -8px;
            right: -8px;
            font-size: 18px;
            z-index: 5;
        }
        
        .content-wrapper { position: relative; z-index: 2; min-height: 100vh; padding: 40px 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        
        .card {
            background: var(--bg-card); backdrop-filter: blur(10px);
            border-radius: var(--radius-lg); box-shadow: var(--shadow-soft);
            border: 1px solid rgba(255,255,255,0.6); padding: 32px; margin-bottom: 24px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-sage), #88a07a);
            color: white; border: none; padding: 14px 28px;
            border-radius: var(--radius-md); font-weight: 600; font-size: 15px;
            cursor: pointer; transition: all 0.3s ease;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(156, 175, 136, 0.3); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        .btn-secondary {
            background: rgba(255,255,255,0.7); color: var(--text-primary);
            border: 1px solid rgba(0,0,0,0.08); padding: 12px 24px;
            border-radius: var(--radius-md); font-weight: 500; font-size: 14px;
            cursor: pointer; transition: all 0.2s ease;
        }
        .btn-secondary:hover { background: rgba(255,255,255,0.9); }
        
        .input-field {
            width: 100%; background: rgba(255,255,255,0.7);
            border: 1px solid rgba(0,0,0,0.06); border-radius: var(--radius-md);
            padding: 14px 18px; font-size: 16px; color: var(--text-primary);
            transition: all 0.3s ease;
        }
        .input-field:focus { 
            outline: none; background: white; border-color: var(--accent-sage);
            box-shadow: 0 0 0 3px rgba(156, 175, 136, 0.1);
        }
        .input-field::placeholder { color: var(--text-muted); }
        textarea.input-field { min-height: 100px; resize: vertical; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-secondary); }
        
        .category-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 16px; margin: 24px 0; }
        .category-card {
            background: var(--bg-card); border: 2px solid transparent;
            border-radius: var(--radius-md); padding: 20px; text-align: center;
            cursor: pointer; transition: all 0.3s ease;
        }
        .category-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-medium); }
        .category-card.selected { border-color: var(--accent-sage); background: rgba(156, 175, 136, 0.1); }
        .category-card .icon { font-size: 36px; margin-bottom: 8px; }
        .category-card .label { font-weight: 600; font-size: 14px; }
        
        /* Timeline */
        .timeline { position: relative; padding-left: 30px; }
        .timeline::before {
            content: ''; position: absolute; left: 10px; top: 0; bottom: 0;
            width: 2px; background: linear-gradient(to bottom, var(--accent-sage), var(--accent-lavender));
        }
        
        .milestone-item {
            position: relative; padding: 20px; margin-bottom: 16px;
            background: var(--bg-card); border-radius: var(--radius-md);
            border: 1px solid rgba(0,0,0,0.06); cursor: pointer; transition: all 0.3s ease;
        }
        .milestone-item:hover { transform: translateX(4px); box-shadow: var(--shadow-medium); }
        .milestone-item::before {
            content: ''; position: absolute; left: -24px; top: 28px;
            width: 12px; height: 12px; border-radius: 50%;
            background: var(--accent-sage); border: 3px solid var(--bg-primary);
        }
        
        .milestone-item.major { border-left: 4px solid var(--accent-gold); }
        .milestone-item.major::before { width: 16px; height: 16px; left: -26px; background: var(--accent-gold); }
        .milestone-item.minor { border-left: 4px solid var(--accent-lavender); }
        
        .milestone-item.completed::before { background: var(--success); }
        .milestone-item.not-reached::before { background: var(--danger); }
        .milestone-item.completed { border-left-color: var(--success); background: rgba(125,155,118,0.05); }
        .milestone-item.not-reached { border-left-color: var(--danger); opacity: 0.7; }
        .milestone-item.not-reached .milestone-title { text-decoration: line-through; }
        
        .milestone-type-badge {
            display: inline-block; padding: 2px 10px; border-radius: 12px;
            font-size: 10px; font-weight: 700; text-transform: uppercase; margin-bottom: 8px;
        }
        .milestone-type-badge.major { background: rgba(201, 168, 108, 0.2); color: var(--accent-gold); }
        .milestone-type-badge.minor { background: rgba(184, 169, 201, 0.2); color: var(--accent-lavender); }
        
        .milestone-date { font-size: 12px; color: var(--text-muted); margin-bottom: 4px; }
        .milestone-title { font-weight: 600; font-size: 16px; margin-bottom: 6px; }
        .milestone-kpi { font-size: 13px; color: var(--accent-sage); font-weight: 600; margin-bottom: 6px; }
        .milestone-description { font-size: 14px; color: var(--text-secondary); }
        .milestone-status {
            display: inline-block; padding: 4px 12px; border-radius: 20px;
            font-size: 12px; font-weight: 600; margin-top: 8px;
        }
        .milestone-status.pending { background: rgba(201, 168, 108, 0.2); color: var(--warning); }
        .milestone-status.completed { background: rgba(125, 155, 118, 0.2); color: var(--success); }
        .milestone-status.not-reached { background: rgba(212, 165, 165, 0.2); color: var(--danger); }
        
        /* Modal */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5); z-index: 1000;
            display: flex; align-items: center; justify-content: center;
            padding: 24px; animation: fadeIn 0.3s ease;
        }
        .modal {
            background: var(--bg-primary); border-radius: var(--radius-lg);
            max-width: 500px; width: 100%; max-height: 85vh; overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2); animation: slideIn 0.3s ease;
        }
        .modal-header {
            padding: 24px; border-bottom: 1px solid rgba(0,0,0,0.06);
            display: flex; justify-content: space-between; align-items: flex-start;
        }
        .modal-body { padding: 24px; }
        .modal-footer { 
            padding: 16px 24px; border-top: 1px solid rgba(0,0,0,0.06);
            display: flex; gap: 12px; justify-content: flex-end;
        }
        .close-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-muted); }
        .close-btn:hover { color: var(--text-primary); }
        
        /* Help Modal - Solid white background */
        .modal-content {
            background: #ffffff;
            border-radius: var(--radius-lg);
            max-width: 500px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.25);
            animation: slideIn 0.3s ease;
        }
        .modal-content .modal-header {
            background: #ffffff;
            padding: 20px 24px;
            border-bottom: 1px solid rgba(0,0,0,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-content .modal-body {
            background: #ffffff;
            padding: 24px;
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-muted);
            line-height: 1;
            padding: 0;
            transition: color 0.2s ease;
        }
        .modal-close:hover { color: var(--text-primary); }
        
        /* Progress */
        .progress-container { margin: 24px 0; }
        .progress-header { display: flex; justify-content: space-between; margin-bottom: 8px; }
        .progress-bar { height: 12px; background: var(--bg-secondary); border-radius: 6px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-sage), var(--success)); border-radius: 6px; transition: width 0.5s ease; }
        
        /* Stats */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin: 24px 0; }
        .stat-card { text-align: center; padding: 20px 12px; background: var(--bg-card); border-radius: var(--radius-md); }
        .stat-value { font-size: 28px; font-weight: 700; color: var(--accent-sage); }
        .stat-label { font-size: 11px; color: var(--text-muted); margin-top: 4px; }
        
        /* Header */
        .app-header { text-align: center; margin-bottom: 40px; }
        .app-header h1 {
            font-size: 36px; margin-bottom: 8px;
            background: linear-gradient(135deg, var(--accent-sage), var(--accent-lavender));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .app-header .subtitle { color: var(--text-secondary); font-size: 16px; }
        
        /* Daily Grid */
        .daily-grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 4px; }
        .daily-cell {
            aspect-ratio: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center; border-radius: 6px;
            font-size: 10px; position: relative;
        }
        .daily-cell.achieved { background: rgba(125, 155, 118, 0.3); }
        .daily-cell.missed { background: rgba(212, 165, 165, 0.3); }
        .daily-cell.pending { background: var(--bg-secondary); }
        .daily-cell .day-num { font-weight: 700; font-size: 11px; }
        
        /* Compound Chart */
        .compound-chart { margin-top: 24px; padding: 24px; background: var(--bg-secondary); border-radius: var(--radius-md); }
        .compound-row { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .compound-label { width: 120px; font-size: 13px; font-weight: 600; }
        .compound-bar-container { flex: 1; height: 24px; background: rgba(0,0,0,0.05); border-radius: 12px; overflow: hidden; }
        .compound-bar {
            height: 100%; border-radius: 12px; transition: width 0.5s ease;
            display: flex; align-items: center; justify-content: flex-end;
            padding-right: 8px; font-size: 11px; font-weight: 700; color: white;
        }
        .compound-bar.ideal { background: linear-gradient(90deg, var(--accent-sage), var(--success)); }
        .compound-bar.actual { background: linear-gradient(90deg, var(--accent-lavender), #a090b8); }
        .compound-bar.lost { background: linear-gradient(90deg, var(--danger), #c49292); }
        
        /* Nav Tabs */
        .nav-tabs { display: flex; gap: 8px; margin-bottom: 24px; flex-wrap: wrap; }
        .nav-tab {
            padding: 10px 20px; background: var(--bg-secondary); border: none;
            border-radius: var(--radius-md); cursor: pointer; font-weight: 500; transition: all 0.2s ease;
        }
        .nav-tab.active { background: var(--accent-sage); color: white; }
        .nav-tab:hover:not(.active) { background: rgba(156, 175, 136, 0.2); }
        
        /* KPI Section */
        .kpi-section { background: var(--bg-secondary); border-radius: var(--radius-md); padding: 20px; margin-top: 20px; }
        .kpi-row { display: flex; gap: 16px; margin-bottom: 12px; flex-wrap: wrap; }
        .kpi-item { flex: 1; min-width: 140px; }
        .kpi-item label { display: block; font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: 4px; }
        .kpi-item input {
            width: 100%; padding: 10px 14px; border-radius: var(--radius-sm);
            border: 1px solid rgba(0,0,0,0.06); background: white; font-size: 14px;
        }
        .kpi-item input:focus { outline: none; border-color: var(--accent-sage); }
        
        /* Fixed elements - RESET BUTTON - ALWAYS VISIBLE */
        .reset-btn { 
            position: fixed !important; 
            bottom: 24px !important; 
            right: 24px !important; 
            z-index: 9999 !important; /* Very high z-index to stay on top */
            background: rgba(212, 165, 165, 0.2) !important;
            border: 2px solid var(--danger) !important;
            color: var(--danger) !important;
            font-size: 13px;
            font-weight: 600;
            padding: 12px 18px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex !important;
            align-items: center;
            gap: 6px;
        }
        .reset-btn:hover {
            background: var(--danger) !important;
            color: white !important;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(212, 165, 165, 0.4);
        }
        
        /* LinkedIn Button */
        .linkedin-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: #0077b5;
            color: white;
            padding: 12px 24px;
            border-radius: var(--radius-md);
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .linkedin-btn:hover { background: #005885; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 119, 181, 0.3); }
        
        /* Social Share Buttons */
        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: var(--radius-md);
            text-decoration: none;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        .social-btn:hover { transform: translateY(-2px); }
        .social-btn.twitter { background: #1DA1F2; color: white; }
        .social-btn.twitter:hover { background: #0d8ce0; }
        .social-btn.instagram { background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); color: white; }
        .social-btn.instagram:hover { opacity: 0.9; }
        .social-btn.facebook { background: #1877F2; color: white; }
        .social-btn.facebook:hover { background: #0d6ce0; }
        .social-btn.whatsapp { background: #25D366; color: white; }
        .social-btn.whatsapp:hover { background: #1fb855; }
        
        /* Help Button */
        .help-btn {
            position: fixed;
            bottom: 24px;
            left: 24px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--accent-lavender);
            color: white;
            border: none;
            font-size: 20px;
            cursor: pointer;
            box-shadow: var(--shadow-medium);
            transition: all 0.3s ease;
            z-index: 100;
        }
        .help-btn:hover { transform: scale(1.1); background: #a090b8; }
        
        /* Storage Indicator */
        .storage-indicator {
            position: fixed;
            top: 16px;
            right: 16px;
            background: white;
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow-soft);
            z-index: 100;
            color: var(--text-secondary);
        }
        .storage-indicator.saved { color: var(--success); }
        
        /* Footer */
        .app-footer {
            background: var(--bg-secondary);
            border-top: 1px solid rgba(0,0,0,0.06);
            padding: 32px 24px;
            margin-top: 32px;
            border-radius: var(--radius-md);
        }
        .connect-section {
            text-align: center;
            margin-bottom: 24px;
        }
        .share-section {
            background: white;
            border-radius: var(--radius-md);
            padding: 20px;
            text-align: center;
            margin-bottom: 24px;
        }
        .share-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 16px;
        }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        
        @media (max-width: 700px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .category-grid { grid-template-columns: repeat(2, 1fr); }
            .daily-grid { grid-template-columns: repeat(7, 1fr); }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        console.log('37x Me Simple - Script Loading...');
        const { useState, useEffect } = React;
        console.log('React hooks loaded successfully');
        
        // ==================== CONFIGURATION ====================
        const CATEGORIES = {
            fitness: { 
                icon: 'ðŸŒ¿', label: 'Fitness & Health', color: '#9caf88',
                kpiFields: [
                    { id: 'startValue', label: 'Weight', type: 'number', unit: 'kg', isStart: true },
                    { id: 'targetValue', label: 'Weight', type: 'number', unit: 'kg', isTarget: true }
                ],
                unit: 'kg',
                milestoneTemplates: [
                    // Major milestones
                    { type: 'major', percent: 25, title: '25% Goal Reached', desc: 'Quarter way to your target!' },
                    { type: 'major', percent: 50, title: 'HALFWAY CHAMPION! ðŸ†', desc: 'You\'ve achieved half your goal!' },
                    { type: 'major', percent: 75, title: '75% - Almost There!', desc: 'The finish line is in sight!' },
                    { type: 'major', percent: 100, title: 'ðŸŽ¯ GOAL ACHIEVED!', desc: 'You did it! Congratulations!' },
                    // Minor milestones
                    { type: 'minor', percent: 10, title: 'First 10% Down', desc: 'Great start to your journey!' },
                    { type: 'minor', percent: 20, title: 'Building Momentum', desc: 'You\'re making progress!' },
                    { type: 'minor', percent: 30, title: 'Consistency Showing', desc: 'Your habits are forming!' },
                    { type: 'minor', percent: 40, title: 'Steady Progress', desc: 'Keep up the great work!' },
                    { type: 'minor', percent: 60, title: 'Past Halfway', desc: 'More done than left!' },
                    { type: 'minor', percent: 70, title: 'Strong Finish Ahead', desc: 'Final stretch approaching!' },
                    { type: 'minor', percent: 80, title: 'Final Push', desc: 'So close to your goal!' },
                    { type: 'minor', percent: 90, title: 'Almost Complete', desc: 'Just a little more!' }
                ]
            },
            career: { 
                icon: 'ðŸŒ»', label: 'Career & Growth', color: '#c9a86c',
                kpiFields: [
                    { id: 'startValue', label: 'Skills Mastered', type: 'number', unit: 'skills', isStart: true },
                    { id: 'targetValue', label: 'Skills to Master', type: 'number', unit: 'skills', isTarget: true }
                ],
                unit: 'skills',
                milestoneTemplates: [
                    { type: 'major', percent: 25, title: 'Foundation Built', desc: 'Core skills acquired!' },
                    { type: 'major', percent: 50, title: 'SKILL SET EXPANDED! ðŸ†', desc: 'Halfway to mastery!' },
                    { type: 'major', percent: 75, title: 'Expert Territory', desc: 'Advanced level reached!' },
                    { type: 'major', percent: 100, title: 'ðŸŽ¯ CAREER GOAL MET!', desc: 'Target achieved!' },
                    { type: 'minor', percent: 10, title: 'Learning Started', desc: 'First steps taken!' },
                    { type: 'minor', percent: 20, title: 'Gaining Traction', desc: 'Skills improving!' },
                    { type: 'minor', percent: 35, title: 'Competency Growing', desc: 'Confidence building!' },
                    { type: 'minor', percent: 45, title: 'Nearing Halfway', desc: 'Great progress!' },
                    { type: 'minor', percent: 60, title: 'Advanced Learning', desc: 'Deep knowledge forming!' },
                    { type: 'minor', percent: 70, title: 'Expertise Building', desc: 'Mastery approaching!' },
                    { type: 'minor', percent: 85, title: 'Near Complete', desc: 'Almost there!' },
                    { type: 'minor', percent: 95, title: 'Final Steps', desc: 'Just polish needed!' }
                ]
            },
            learning: { 
                icon: 'ðŸ“–', label: 'Learning & Wisdom', color: '#b8a9c9',
                kpiFields: [
                    { id: 'startValue', label: 'Study Hours', type: 'number', unit: 'hours', isStart: true },
                    { id: 'targetValue', label: 'Study Hours', type: 'number', unit: 'hours', isTarget: true }
                ],
                unit: 'hours',
                milestoneTemplates: [
                    { type: 'major', percent: 25, title: 'Foundations Solid', desc: 'Core concepts understood!' },
                    { type: 'major', percent: 50, title: 'KNOWLEDGE EXPANDING! ðŸ†', desc: 'Halfway through!' },
                    { type: 'major', percent: 75, title: 'Advanced Understanding', desc: 'Deep knowledge gained!' },
                    { type: 'major', percent: 100, title: 'ðŸŽ¯ LEARNING COMPLETE!', desc: 'Mastery achieved!' },
                    { type: 'minor', percent: 10, title: 'Journey Begun', desc: 'First lessons done!' },
                    { type: 'minor', percent: 20, title: 'Concepts Forming', desc: 'Understanding growing!' },
                    { type: 'minor', percent: 35, title: 'Knowledge Building', desc: 'Progress visible!' },
                    { type: 'minor', percent: 45, title: 'Approaching Middle', desc: 'Great momentum!' },
                    { type: 'minor', percent: 60, title: 'Deep Dive', desc: 'Complex topics mastered!' },
                    { type: 'minor', percent: 70, title: 'Integration Phase', desc: 'Connecting dots!' },
                    { type: 'minor', percent: 85, title: 'Near Mastery', desc: 'Almost complete!' },
                    { type: 'minor', percent: 95, title: 'Final Review', desc: 'Polishing knowledge!' }
                ]
            },
            finances: { 
                icon: 'ðŸ‚', label: 'Financial Peace', color: '#c9b1a0',
                kpiFields: [
                    { id: 'startValue', label: 'Savings', type: 'number', unit: '$', isStart: true },
                    { id: 'targetValue', label: 'Savings', type: 'number', unit: '$', isTarget: true }
                ],
                unit: '$',
                milestoneTemplates: [
                    { type: 'major', percent: 25, title: 'First Quarter Saved', desc: '25% of goal reached!' },
                    { type: 'major', percent: 50, title: 'HALFWAY TO FREEDOM! ðŸ†', desc: '50% saved!' },
                    { type: 'major', percent: 75, title: 'Financial Strength', desc: '75% of target!' },
                    { type: 'major', percent: 100, title: 'ðŸŽ¯ SAVINGS GOAL MET!', desc: 'Financial goal achieved!' },
                    { type: 'minor', percent: 10, title: 'Saving Started', desc: 'First 10% saved!' },
                    { type: 'minor', percent: 20, title: 'Building Buffer', desc: 'Growing steadily!' },
                    { type: 'minor', percent: 35, title: 'Momentum Strong', desc: 'Great discipline!' },
                    { type: 'minor', percent: 45, title: 'Almost Halfway', desc: 'Keep it up!' },
                    { type: 'minor', percent: 60, title: 'Past Halfway', desc: 'More saved than left!' },
                    { type: 'minor', percent: 70, title: 'Strong Position', desc: 'Wealth building!' },
                    { type: 'minor', percent: 85, title: 'Nearly There', desc: 'So close!' },
                    { type: 'minor', percent: 95, title: 'Final Stretch', desc: 'Almost complete!' }
                ]
            },
            relationships: { 
                icon: 'ðŸŒ¸', label: 'Relationships', color: '#d4a5a5',
                kpiFields: [
                    { id: 'startValue', label: 'Meaningful Connections', type: 'number', unit: 'connections', isStart: true },
                    { id: 'targetValue', label: 'Meaningful Connections', type: 'number', unit: 'connections', isTarget: true }
                ],
                unit: 'connections',
                milestoneTemplates: [
                    { type: 'major', percent: 25, title: 'Bonds Forming', desc: 'Connections strengthening!' },
                    { type: 'major', percent: 50, title: 'RELATIONSHIPS GROWING! ðŸ†', desc: 'Halfway there!' },
                    { type: 'major', percent: 75, title: 'Deep Connections', desc: 'Strong bonds built!' },
                    { type: 'major', percent: 100, title: 'ðŸŽ¯ RELATIONSHIP GOAL!', desc: 'Connections achieved!' },
                    { type: 'minor', percent: 10, title: 'Reaching Out', desc: 'First steps taken!' },
                    { type: 'minor', percent: 20, title: 'Opening Up', desc: 'Trust building!' },
                    { type: 'minor', percent: 35, title: 'Consistency Showing', desc: 'Regular connection!' },
                    { type: 'minor', percent: 45, title: 'Bonds Deepening', desc: 'Quality improving!' },
                    { type: 'minor', percent: 60, title: 'Strong Network', desc: 'Great progress!' },
                    { type: 'minor', percent: 70, title: 'Meaningful Ties', desc: 'Deep relationships!' },
                    { type: 'minor', percent: 85, title: 'Almost There', desc: 'Nearly complete!' },
                    { type: 'minor', percent: 95, title: 'Final Connections', desc: 'Last steps!' }
                ]
            },
            creativity: { 
                icon: 'ðŸŽ¨', label: 'Creativity & Art', color: '#a8c4c4',
                kpiFields: [
                    { id: 'startValue', label: 'Creative Works', type: 'number', unit: 'pieces', isStart: true },
                    { id: 'targetValue', label: 'Creative Works', type: 'number', unit: 'pieces', isTarget: true }
                ],
                unit: 'pieces',
                milestoneTemplates: [
                    { type: 'major', percent: 25, title: 'Creative Flow', desc: 'Style emerging!' },
                    { type: 'major', percent: 50, title: 'ARTISTIC GROWTH! ðŸ†', desc: 'Halfway to vision!' },
                    { type: 'major', percent: 75, title: 'Mastery Forming', desc: 'Skills refined!' },
                    { type: 'major', percent: 100, title: 'ðŸŽ¯ CREATIVE VISION!', desc: 'Artistic goal met!' },
                    { type: 'minor', percent: 10, title: 'First Creations', desc: 'Journey started!' },
                    { type: 'minor', percent: 20, title: 'Finding Voice', desc: 'Style developing!' },
                    { type: 'minor', percent: 35, title: 'Expression Growing', desc: 'Skills improving!' },
                    { type: 'minor', percent: 45, title: 'Creative Momentum', desc: 'Great flow!' },
                    { type: 'minor', percent: 60, title: 'Artistic Vision', desc: 'Clear direction!' },
                    { type: 'minor', percent: 70, title: 'Refined Work', desc: 'Quality rising!' },
                    { type: 'minor', percent: 85, title: 'Near Complete', desc: 'Almost there!' },
                    { type: 'minor', percent: 95, title: 'Final Touches', desc: 'Polishing work!' }
                ]
            },
            mindset: { 
                icon: 'ðŸ§˜', label: 'Mindset & Soul', color: '#b8a9c9',
                kpiFields: [
                    { id: 'startValue', label: 'Mindful Minutes/Day', type: 'number', unit: 'mins', isStart: true },
                    { id: 'targetValue', label: 'Mindful Minutes/Day', type: 'number', unit: 'mins', isTarget: true }
                ],
                unit: 'habits',
                milestoneTemplates: [
                    { type: 'major', percent: 25, title: 'Inner Peace Growing', desc: 'Mindfulness developing!' },
                    { type: 'major', percent: 50, title: 'MENTAL CLARITY! ðŸ†', desc: 'Halfway to zen!' },
                    { type: 'major', percent: 75, title: 'Deep Wisdom', desc: 'Profound insights!' },
                    { type: 'major', percent: 100, title: 'ðŸŽ¯ INNER MASTERY!', desc: 'Mindset goal achieved!' },
                    { type: 'minor', percent: 10, title: 'Awareness Begins', desc: 'First insights!' },
                    { type: 'minor', percent: 20, title: 'Calm Developing', desc: 'Peace growing!' },
                    { type: 'minor', percent: 35, title: 'Habits Forming', desc: 'Routine building!' },
                    { type: 'minor', percent: 45, title: 'Steady Practice', desc: 'Consistency strong!' },
                    { type: 'minor', percent: 60, title: 'Deep Practice', desc: 'Understanding grows!' },
                    { type: 'minor', percent: 70, title: 'Wisdom Rising', desc: 'Insights flowing!' },
                    { type: 'minor', percent: 85, title: 'Near Enlightenment', desc: 'Almost there!' },
                    { type: 'minor', percent: 95, title: 'Final Integration', desc: 'Complete soon!' }
                ]
            },
            custom: { 
                icon: 'âœ¨', label: 'Custom Journey', color: '#c9b1a0',
                kpiFields: [
                    { id: 'startValue', label: 'Your Metric', type: 'number', unit: 'units', isStart: true },
                    { id: 'targetValue', label: 'Your Metric', type: 'number', unit: 'units', isTarget: true }
                ],
                unit: 'units',
                milestoneTemplates: [
                    { type: 'major', percent: 25, title: '25% Complete', desc: 'Quarter done!' },
                    { type: 'major', percent: 50, title: 'HALFWAY! ðŸ†', desc: '50% achieved!' },
                    { type: 'major', percent: 75, title: '75% There', desc: 'Almost done!' },
                    { type: 'major', percent: 100, title: 'ðŸŽ¯ GOAL MET!', desc: 'You did it!' },
                    { type: 'minor', percent: 10, title: '10% Done', desc: 'Great start!' },
                    { type: 'minor', percent: 20, title: '20% Complete', desc: 'Good progress!' },
                    { type: 'minor', percent: 35, title: '35% Achieved', desc: 'Keep going!' },
                    { type: 'minor', percent: 45, title: '45% There', desc: 'Almost halfway!' },
                    { type: 'minor', percent: 60, title: '60% Done', desc: 'Over halfway!' },
                    { type: 'minor', percent: 70, title: '70% Complete', desc: 'Great work!' },
                    { type: 'minor', percent: 85, title: '85% Achieved', desc: 'So close!' },
                    { type: 'minor', percent: 95, title: '95% Done', desc: 'Final push!' }
                ]
            }
        };
        
        // ==================== CATEGORY-SPECIFIC PRACTICAL TIPS ====================
        const CATEGORY_TIPS = {
            fitness: {
                10: ['Add 10 extra minutes to your workout', 'Drink 8 glasses of water daily', 'Cut out one sugary drink'],
                20: ['Increase weights by 5-10%', 'Add one more workout day per week', 'Prep meals for 3 days ahead'],
                25: ['Try a new exercise variation', 'Track your macros for a week', 'Get a workout buddy for accountability'],
                35: ['Increase protein intake by 20g/day', 'Add HIIT sessions twice a week', 'Sleep 7-8 hours consistently'],
                45: ['Reassess your workout split', 'Take progress photos', 'Reduce processed food intake'],
                50: ['Increase cardio duration by 15 mins', 'Try intermittent fasting', 'Add stretching/yoga once a week'],
                60: ['Push for personal records', 'Meal prep for the entire week', 'Add active recovery days'],
                70: ['Fine-tune your diet for final push', 'Increase workout intensity', 'Track every calorie consumed'],
                75: ['Add morning walks', 'Cut sodium for less water retention', 'Focus on compound movements'],
                85: ['Peak week preparation', 'Reduce carbs gradually', 'Stay consistent with sleep schedule'],
                95: ['Final push - max effort workouts', 'Perfect your nutrition', 'Visualize reaching your goal weight'],
                100: ['Maintain with sustainable habits', 'Plan your maintenance calories', 'Set your next fitness goal']
            },
            career: {
                10: ['Update your LinkedIn profile', 'Identify 3 key skills to develop', 'Schedule learning time daily'],
                20: ['Complete an online course module', 'Network with 2 new professionals', 'Document your achievements'],
                25: ['Ask for feedback from peers', 'Start a side project', 'Read industry news daily'],
                35: ['Build a portfolio piece', 'Attend a virtual conference', 'Practice interview questions'],
                45: ['Mentor someone junior', 'Publish an article or post', 'Take on a stretch assignment'],
                50: ['Request a performance review', 'Expand your professional network', 'Learn a complementary skill'],
                60: ['Lead a team project', 'Build relationships with leadership', 'Create a career roadmap'],
                70: ['Negotiate for new responsibilities', 'Speak at a meetup or event', 'Get a professional certification'],
                75: ['Apply for target roles internally', 'Build executive presence', 'Refine your personal brand'],
                85: ['Prepare for promotion conversation', 'Document all achievements', 'Get endorsements from seniors'],
                95: ['Final interview prep', 'Negotiate your offer', 'Plan your first 90 days'],
                100: ['Celebrate your achievement!', 'Help others reach their goals', 'Set your next career milestone']
            },
            learning: {
                10: ['Set up a distraction-free study space', 'Create a study schedule', 'Take notes in your own words'],
                20: ['Use spaced repetition for review', 'Teach a concept to someone', 'Join a study group or forum'],
                25: ['Complete practice exercises daily', 'Create flashcards for key concepts', 'Watch supplementary videos'],
                35: ['Build a small project with what you learned', 'Ask questions in community forums', 'Review and revise notes'],
                45: ['Take a practice test', 'Identify weak areas to focus on', 'Create mind maps for complex topics'],
                50: ['Work on a real-world project', 'Contribute to open source/community', 'Find a mentor in the field'],
                60: ['Deep dive into advanced topics', 'Write a blog post about your learning', 'Help beginners with basics'],
                70: ['Build a portfolio project', 'Apply knowledge to solve real problems', 'Network with professionals'],
                75: ['Prepare for certification exam', 'Review all materials systematically', 'Practice under timed conditions'],
                85: ['Take mock exams', 'Focus on weak areas only', 'Get feedback on your projects'],
                95: ['Final revision of key concepts', 'Rest well before any exam', 'Trust your preparation'],
                100: ['Apply your new skills!', 'Update your resume', 'Plan your next learning goal']
            },
            finances: {
                10: ['Track every expense for a week', 'Cancel unused subscriptions', 'Set up automatic savings transfer'],
                20: ['Create a monthly budget', 'Build emergency fund (1 month)', 'Review all recurring charges'],
                25: ['Negotiate one bill (internet, phone)', 'Start meal planning to save', 'Use cashback apps'],
                35: ['Increase savings rate by 5%', 'Pay off smallest debt first', 'Find one additional income source'],
                45: ['Build emergency fund (2 months)', 'Automate all bill payments', 'Review and optimize insurance'],
                50: ['Max out employer 401k match', 'Pay off high-interest debt', 'Start investing small amounts'],
                60: ['Build emergency fund (3 months)', 'Diversify income streams', 'Review investment allocations'],
                70: ['Increase retirement contributions', 'Pay down mortgage faster', 'Consult a financial advisor'],
                75: ['Build emergency fund (6 months)', 'Optimize tax strategies', 'Review estate planning'],
                85: ['Max out retirement accounts', 'Explore additional investments', 'Teach others about finances'],
                95: ['Final push to savings goal', 'Rebalance portfolio', 'Plan for maintenance phase'],
                100: ['Celebrate financial milestone!', 'Set new financial goals', 'Help others with their finances']
            },
            relationships: {
                10: ['Reach out to one old friend', 'Schedule quality time with family', 'Practice active listening'],
                20: ['Send thoughtful messages to 3 people', 'Plan a meaningful activity together', 'Put phone away during conversations'],
                25: ['Have a deep conversation with someone', 'Express gratitude to loved ones', 'Join a community group'],
                35: ['Plan a surprise for someone special', 'Resolve one lingering conflict', 'Be fully present in interactions'],
                45: ['Host a small gathering', 'Check in on friends regularly', 'Offer help without being asked'],
                50: ['Strengthen your closest relationships', 'Travel or create memories together', 'Share your goals with loved ones'],
                60: ['Expand your social circle', 'Attend networking events', 'Be vulnerable and authentic'],
                70: ['Deepen trust with key relationships', 'Celebrate others\' achievements', 'Be a reliable support system'],
                75: ['Plan meaningful traditions', 'Invest in long-distance relationships', 'Practice forgiveness'],
                85: ['Build lasting memories', 'Express love and appreciation daily', 'Be the friend you want to have'],
                95: ['Reflect on relationship growth', 'Thank those who supported you', 'Plan future together time'],
                100: ['Cherish your connections!', 'Maintain the habits you built', 'Help others build relationships']
            },
            creativity: {
                10: ['Create for 15 minutes daily', 'Try a new medium or tool', 'Start an inspiration board'],
                20: ['Complete one small piece', 'Share work with a trusted friend', 'Study work you admire'],
                25: ['Develop a consistent style element', 'Enter a small competition', 'Document your process'],
                35: ['Collaborate with another creative', 'Take a class or workshop', 'Experiment with new techniques'],
                45: ['Build a body of work (5+ pieces)', 'Get feedback from peers', 'Create despite not feeling inspired'],
                50: ['Share your work publicly', 'Accept constructive criticism', 'Develop your unique voice'],
                60: ['Take on a challenging project', 'Teach what you\'ve learned', 'Build an online portfolio'],
                70: ['Seek professional opportunities', 'Network with other creatives', 'Apply to exhibitions/shows'],
                75: ['Refine and polish your best work', 'Build an audience', 'Consider monetizing your art'],
                85: ['Create your masterpiece', 'Document your creative journey', 'Inspire others'],
                95: ['Final touches on your work', 'Prepare for showcase', 'Celebrate your creative growth'],
                100: ['Launch your creative work!', 'Plan your next creative adventure', 'Keep creating!']
            },
            mindset: {
                10: ['Meditate for 5 minutes daily', 'Write 3 gratitudes each morning', 'Practice deep breathing'],
                20: ['Increase meditation to 10 minutes', 'Journal your thoughts daily', 'Identify negative thought patterns'],
                25: ['Create a morning routine', 'Practice positive affirmations', 'Read 10 pages of self-help daily'],
                35: ['Try a digital detox day', 'Practice saying no', 'Identify your core values'],
                45: ['Meditate for 15 minutes', 'Therapy or coaching session', 'Practice self-compassion'],
                50: ['Build a consistent evening routine', 'Address one limiting belief', 'Practice mindfulness throughout day'],
                60: ['Increase meditation to 20 minutes', 'Teach mindfulness to someone', 'Practice non-judgment'],
                70: ['Attend a meditation retreat/workshop', 'Build resilience practices', 'Embrace discomfort'],
                75: ['Master your emotional responses', 'Live according to your values', 'Mentor others on mindset'],
                85: ['Deep inner work on past traumas', 'Practice radical acceptance', 'Build unshakeable peace'],
                95: ['Integrate all practices seamlessly', 'Live with intention daily', 'Share your transformation'],
                100: ['Celebrate inner mastery!', 'Maintain your practices', 'Guide others on their journey']
            },
            custom: {
                10: ['Break goal into daily actions', 'Track progress consistently', 'Remove one obstacle'],
                20: ['Increase daily effort by 10%', 'Find an accountability partner', 'Review and adjust strategy'],
                25: ['Celebrate small wins', 'Document what\'s working', 'Double down on effective methods'],
                35: ['Address your biggest challenge', 'Seek expert advice', 'Stay consistent despite setbacks'],
                45: ['Review progress honestly', 'Adjust timeline if needed', 'Recommit to your goal'],
                50: ['Celebrate halfway point!', 'Refine your approach', 'Push through the plateau'],
                60: ['Increase effort intensity', 'Share progress with others', 'Stay disciplined'],
                70: ['Focus on quality over quantity', 'Eliminate distractions', 'Visualize success'],
                75: ['Final strategy refinement', 'Maximum effort phase', 'Trust the process'],
                85: ['Push through fatigue', 'Stay consistent', 'You\'re almost there'],
                95: ['Final sprint', 'Give it everything', 'Finish strong'],
                100: ['YOU DID IT!', 'Celebrate your achievement', 'Set your next goal']
            }
        };
        
        // Quotes remain universal but inspiring
        const MILESTONE_QUOTES = {
            10: '"The secret of getting ahead is getting started." â€” Mark Twain',
            20: '"Success is the sum of small efforts repeated day in and day out." â€” Robert Collier',
            25: '"The only way to do great work is to love what you do." â€” Steve Jobs',
            35: '"It does not matter how slowly you go as long as you do not stop." â€” Confucius',
            45: '"The middle of every successful project looks like a disaster." â€” Rosabeth Moss Kanter',
            50: '"Believe you can and you\'re halfway there." â€” Theodore Roosevelt',
            60: '"Perseverance is not a long race; it is many short races one after the other." â€” Walter Elliot',
            70: '"Success is not final, failure is not fatal: it is the courage to continue that counts." â€” Winston Churchill',
            75: '"The harder you work for something, the greater you\'ll feel when you achieve it." â€” Unknown',
            85: '"Champions keep playing until they get it right." â€” Billie Jean King',
            95: '"The difference between ordinary and extraordinary is that little extra." â€” Jimmy Johnson',
            100: '"What lies behind us and what lies before us are tiny matters compared to what lies within us." â€” Ralph Waldo Emerson'
        };
        
        // Get practical tips for a milestone based on category and percentage
        const getMilestoneWisdom = (category, percent) => {
            const tips = CATEGORY_TIPS[category] || CATEGORY_TIPS.custom;
            const quotes = MILESTONE_QUOTES;
            
            // Find the closest matching percentage
            const percentages = Object.keys(tips).map(Number).sort((a, b) => a - b);
            const closest = percentages.reduce((prev, curr) => 
                Math.abs(curr - percent) < Math.abs(prev - percent) ? curr : prev
            );
            
            return {
                tips: tips[closest] || tips[50],
                quote: quotes[closest] || quotes[50]
            };
        };
        
        // ==================== UTILITIES ====================
        const getToday = () => new Date().toISOString().split('T')[0];
        
        const formatDate = (dateStr) => {
            if (!dateStr) return '';
            return new Date(dateStr).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        };
        
        const formatDateFull = (dateStr) => {
            if (!dateStr) return '';
            return new Date(dateStr).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        };
        
        const daysBetween = (date1, date2) => {
            return Math.ceil((new Date(date2) - new Date(date1)) / (1000 * 60 * 60 * 24));
        };
        
        const addDays = (dateStr, days) => {
            const date = new Date(dateStr);
            date.setDate(date.getDate() + days);
            return date.toISOString().split('T')[0];
        };
        
        // Generate milestones from templates - each milestone has START DATE and END DATE
        const generateMilestones = (category, goal, journeyStartDate, journeyEndDate, kpis) => {
            const catConfig = CATEGORIES[category];
            const templates = catConfig.milestoneTemplates;
            const totalDays = daysBetween(journeyStartDate, journeyEndDate);
            
            // Use USER-DEFINED KPI (kpiLabel, startValue, targetValue)
            let startVal = parseFloat(kpis.startValue) || 0;
            let targetVal = parseFloat(kpis.targetValue) || 100;
            const totalChange = targetVal - startVal;
            const kpiLabel = kpis.kpiLabel || catConfig.unit || 'units'; // User's custom KPI label
            
            // Sort templates by percent first
            const sortedTemplates = [...templates].sort((a, b) => a.percent - b.percent);
            
            const milestones = sortedTemplates.map((tmpl, idx) => {
                // Calculate this milestone's end date based on percent
                const endDaysOffset = Math.round((tmpl.percent / 100) * totalDays);
                const milestoneEndDate = addDays(journeyStartDate, endDaysOffset);
                
                // Start date = previous milestone's end date (or journey start for first)
                const prevPercent = idx > 0 ? sortedTemplates[idx - 1].percent : 0;
                const startDaysOffset = Math.round((prevPercent / 100) * totalDays);
                const milestoneStartDate = idx === 0 ? journeyStartDate : addDays(journeyStartDate, startDaysOffset);
                
                // Calculate KPI target for this milestone based on percentage progress
                const kpiValue = startVal + (totalChange * tmpl.percent / 100);
                const wisdom = getMilestoneWisdom(category, tmpl.percent);
                
                // Create dynamic description based on user's KPI
                const progressDesc = totalChange > 0 
                    ? `Reach ${kpiValue.toFixed(1)} ${kpiLabel} (${tmpl.percent}% of your goal)`
                    : totalChange < 0 
                        ? `Get down to ${kpiValue.toFixed(1)} ${kpiLabel} (${tmpl.percent}% progress)`
                        : tmpl.desc;
                
                return {
                    id: `m_${Date.now()}_${idx}`,
                    type: tmpl.type,
                    percent: tmpl.percent,
                    title: tmpl.title,
                    description: progressDesc,
                    startDate: milestoneStartDate,  // When work on this milestone begins
                    endDate: milestoneEndDate,      // Target completion date
                    targetDate: milestoneEndDate,   // Keep for backward compatibility
                    kpiTarget: kpiValue.toFixed(1),
                    kpiUnit: kpiLabel,              // Use user's custom KPI label
                    kpiStart: startVal,             // Store starting value for reference
                    kpiEnd: targetVal,              // Store target value for reference
                    tips: wisdom.tips,
                    quote: wisdom.quote,
                    status: 'pending', // pending, completed, not-reached
                    actualValue: null,
                    notes: '',
                    completedAt: null
                };
            });
            
            return milestones;
        };
        
        // ==================== MILESTONE-BASED CALCULATIONS ====================
        // Calculate DAYS-based streak using milestone start/end dates
        const calculateDaysStreak = (milestones, journeyStartDate) => {
            // Safety check for empty/invalid milestones
            if (!milestones || !Array.isArray(milestones) || milestones.length === 0) {
                return { totalDaysWorked: 0, currentStreakDays: 0 };
            }
            
            // Sort milestones by start date (not end date) for proper ordering
            const sorted = [...milestones].sort((a, b) => {
                const aStart = new Date(a.startDate || a.targetDate || new Date());
                const bStart = new Date(b.startDate || b.targetDate || new Date());
                return aStart - bStart;
            });
            
            let totalDaysWorked = 0;
            let currentStreakDays = 0;
            const today = getToday();
            
            for (const m of sorted) {
                const mStart = m.startDate || m.targetDate;
                const mEnd = m.endDate || m.targetDate;
                if (!mStart || !mEnd) continue; // Skip invalid milestones
                
                const daysInThisMilestone = Math.max(0, daysBetween(mStart, mEnd));
                
                if (m.status === 'completed') {
                    totalDaysWorked += daysInThisMilestone;
                    currentStreakDays += daysInThisMilestone;
                } else if (m.status === 'not-reached') {
                    // Streak BREAKS on missed milestone - reset to 0
                    currentStreakDays = 0;
                    // Don't add to totalDaysWorked for missed milestones
                }
                // pending milestones don't affect streak
            }
            
            return {
                totalDaysWorked: totalDaysWorked || 0,
                currentStreakDays: currentStreakDays || 0
            };
        };
        
        // Add days info to milestones (using their start/end dates)
        const getMilestoneDays = (milestones) => {
            if (!milestones || !Array.isArray(milestones) || milestones.length === 0) {
                return [];
            }
            
            const sorted = [...milestones].sort((a, b) => {
                const aEnd = new Date(a.endDate || a.targetDate || new Date());
                const bEnd = new Date(b.endDate || b.targetDate || new Date());
                return aEnd - bEnd;
            });
            
            return sorted.map(m => {
                const mStart = m.startDate || m.targetDate;
                const mEnd = m.endDate || m.targetDate;
                const days = (mStart && mEnd) ? daysBetween(mStart, mEnd) : 0;
                return { ...m, daysInPeriod: Math.max(0, days) };
            });
        };
        
        // Calculate compounding effect based on DAYS (1% daily = 1.01^days)
        // The core 37X principle: 1.01^365 = 37.78X
        const calculateMilestoneCompound = (milestones, targetDate, startDate) => {
            // Safety check for empty/invalid inputs
            if (!milestones || !Array.isArray(milestones)) {
                return {
                    idealX: '1.00', actualX: '1.00', potentialX: '37.78', lostX: '0.00',
                    reached: 0, missed: 0, pending: 0, shouldBeDone: 0, total: 0,
                    streakDays: 0, totalDaysWorked: 0, daysElapsed: 0, daysMissed: 0,
                    totalDaysInJourney: 365, milestonesWithDays: [],
                    dailyRate: 1.01, dailyRatePercent: '1%',
                    nextMilestone: null, daysToNextMilestone: 0,
                    yearlyMultiplier: 37.78, perMilestoneMultiplier: '1.00'
                };
            }
            
            const total = milestones.length;
            const reached = milestones.filter(m => m.status === 'completed').length;
            const missed = milestones.filter(m => m.status === 'not-reached').length;
            const pending = milestones.filter(m => m.status === 'pending').length;
            
            const today = getToday();
            const shouldBeDone = milestones.filter(m => m.targetDate && m.targetDate <= today).length;
            
            // DAYS-based streak calculation (using milestone start/end dates)
            const daysData = calculateDaysStreak(milestones, startDate);
            const milestonesWithDays = getMilestoneDays(milestones);
            
            // Total days in journey
            const totalDaysInJourney = startDate ? daysBetween(startDate, targetDate) : 365;
            
            // Days elapsed since journey start (how many days SHOULD have been worked by now)
            const daysElapsed = startDate ? Math.max(0, daysBetween(startDate, today)) : 0;
            
            // ========== THE CORE 37X CALCULATION ==========
            // 1% daily improvement = 1.01^days
            // 365 days = 1.01^365 = 37.78X
            const DAILY_RATE = 1.01;  // 1% daily improvement
            
            // actualX = 1.01^(days actually worked) - YOUR REALITY
            const actualX = Math.pow(DAILY_RATE, daysData.totalDaysWorked);
            
            // idealX = 1.01^(days elapsed) - WHAT YOU SHOULD HAVE IF WORKING EVERY DAY
            const idealX = Math.pow(DAILY_RATE, Math.min(daysElapsed, totalDaysInJourney));
            
            // potentialX = 1.01^(total journey days) - FULL POTENTIAL
            const potentialX = Math.pow(DAILY_RATE, totalDaysInJourney);
            
            // lostX = growth lost due to missed days
            const lostX = idealX - actualX;
            
            // Calculate days missed (expected - actual)
            const daysMissed = Math.max(0, daysElapsed - daysData.totalDaysWorked);
            
            // Next milestone info
            const nextMilestone = milestones
                .filter(m => m.status === 'pending')
                .sort((a, b) => new Date(a.targetDate) - new Date(b.targetDate))[0];
            
            const daysToNextMilestone = nextMilestone 
                ? daysBetween(today, nextMilestone.targetDate)
                : 0;
            
            return {
                // The X multipliers (1.01^days)
                idealX: idealX.toFixed(2),
                actualX: actualX.toFixed(2),
                potentialX: potentialX.toFixed(2),
                lostX: Math.max(0, lostX).toFixed(2),
                // Milestone counts
                reached,
                missed,
                pending,
                shouldBeDone,
                total,
                // Days-based metrics (THE KEY TO 37X)
                streakDays: daysData.currentStreakDays,
                totalDaysWorked: daysData.totalDaysWorked,
                daysElapsed,
                daysMissed,
                totalDaysInJourney,
                milestonesWithDays,
                // Daily rate info
                dailyRate: DAILY_RATE,
                dailyRatePercent: '1%',
                // Next milestone
                nextMilestone,
                daysToNextMilestone,
                // Legacy (for compatibility)
                yearlyMultiplier: 37.78,
                perMilestoneMultiplier: Math.pow(37.78, 1 / total).toFixed(2)
            };
        };
        
        // ==================== DATA ====================
        const createEmptyData = () => ({
            version: '3.0.0', // Milestone-based tracking (no calendar-based dailyProgress)
            userName: '',
            journey: null,
            kpis: {},
            milestones: []
        });
        
        // ==================== COMPONENTS ====================
        const WatercolorBackground = () => (
            <div className="watercolor-bg">
                <div className="watercolor-blob" style={{ width: '400px', height: '400px', top: '-100px', right: '-100px', background: 'radial-gradient(circle, rgba(156,175,136,0.6) 0%, rgba(156,175,136,0) 70%)' }}></div>
                <div className="watercolor-blob" style={{ width: '500px', height: '500px', bottom: '-150px', left: '-100px', background: 'radial-gradient(circle, rgba(184,169,201,0.5) 0%, rgba(184,169,201,0) 70%)', animationDelay: '-5s' }}></div>
            </div>
        );
        
        const CategorySelection = ({ onSelect }) => {
            const [selected, setSelected] = useState(null);
            
            return (
                <div className="card" style={{ textAlign: 'center' }}>
                    <h2 style={{ marginBottom: '8px' }}>Choose Your Journey</h2>
                    <p style={{ color: 'var(--text-secondary)', marginBottom: '24px' }}>What area of life do you want to transform?</p>
                    
                    <div className="category-grid">
                        {Object.entries(CATEGORIES).map(([key, cat]) => (
                            <div key={key} className={`category-card ${selected === key ? 'selected' : ''}`} onClick={() => setSelected(key)}>
                                <div className="icon">{cat.icon}</div>
                                <div className="label">{cat.label}</div>
                            </div>
                        ))}
                    </div>
                    
                    <button className="btn-primary" disabled={!selected} onClick={() => onSelect(selected)} style={{ marginTop: '16px' }}>
                        Continue â†’
                    </button>
                </div>
            );
        };
        
        const GoalInput = ({ category, onSubmit, onBack }) => {
            const [name, setName] = useState('');
            const [goal, setGoal] = useState('');
            const [endDate, setEndDate] = useState('');
            const [kpis, setKpis] = useState({});
            
            const cat = CATEGORIES[category];
            const today = getToday();
            
            useEffect(() => {
                // Default to end of current year
                const currentYear = new Date().getFullYear();
                const yearEnd = `${currentYear}-12-31`;
                setEndDate(yearEnd);
            }, []);
            
            // Simple 3-field KPI validation: kpiLabel, startValue, targetValue
            const hasKpiLabel = kpis.kpiLabel && kpis.kpiLabel.trim();
            const hasStartValue = kpis.startValue !== undefined && kpis.startValue !== '' && kpis.startValue !== null;
            const hasTargetValue = kpis.targetValue !== undefined && kpis.targetValue !== '' && kpis.targetValue !== null;
            const allKpisFilled = hasKpiLabel && hasStartValue && hasTargetValue;
            
            // All fields valid check
            const isFormValid = name.trim() && goal.trim() && endDate && allKpisFilled;
            
            const handleSubmit = () => {
                if (!isFormValid) return;
                onSubmit({ name: name.trim(), journey: { category, goal: goal.trim(), startDate: today, endDate }, kpis });
            };
            
            const daysToGoal = endDate ? daysBetween(today, endDate) : 0;
            
            return (
                <div className="card">
                    <button className="btn-secondary" onClick={onBack} style={{ marginBottom: '24px' }}>â† Back</button>
                    
                    <div style={{ textAlign: 'center', marginBottom: '32px' }}>
                        <span style={{ fontSize: '48px' }}>{cat.icon}</span>
                        <h2 style={{ marginTop: '12px' }}>{cat.label}</h2>
                    </div>
                    
                    <div className="form-group">
                        <label className="form-label">Your Name *</label>
                        <input type="text" className="input-field" placeholder="Enter your name..." value={name} onChange={e => setName(e.target.value)} />
                    </div>
                    
                    <div className="form-group">
                        <label className="form-label">What's your goal? *</label>
                        <textarea className="input-field" placeholder="e.g., Lose 7 kgs, learn Python, save $5000..." value={goal} onChange={e => setGoal(e.target.value)} />
                    </div>
                    
                    <div className="form-group">
                        <label className="form-label">Target Date *</label>
                        <input type="date" className="input-field" value={endDate} min={today} onChange={e => setEndDate(e.target.value)} />
                        {daysToGoal > 0 && (
                            <div style={{ marginTop: '12px', padding: '12px', background: 'var(--bg-secondary)', borderRadius: 'var(--radius-sm)' }}>
                                <p style={{ fontSize: '13px', color: 'var(--text-secondary)', marginBottom: '8px' }}>
                                    ðŸ“… {daysToGoal} days â€¢ {cat.milestoneTemplates.length} milestones will be created
                                </p>
                                <p style={{ fontSize: '12px', color: 'var(--accent-sage)', fontWeight: '600' }}>
                                    ðŸ“ˆ Each milestone = {Math.pow(37.78, 1/cat.milestoneTemplates.length).toFixed(2)}X growth multiplier
                                </p>
                            </div>
                        )}
                    </div>
                    
                    <div className="kpi-section">
                        <h3 style={{ marginBottom: '8px', fontSize: '16px' }}>ðŸ“Š Define Your KPI: Current â†’ Target</h3>
                        <p style={{ fontSize: '12px', color: 'var(--text-muted)', marginBottom: '20px' }}>
                            Set ONE key metric to track your progress from where you are to where you want to be
                        </p>
                        
                        {/* Box 1: What do you want to achieve */}
                        <div style={{ marginBottom: '20px', background: 'rgba(201, 177, 160, 0.15)', borderRadius: '12px', padding: '16px', border: '1px solid rgba(201, 177, 160, 0.3)' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '10px' }}>
                                <span style={{ fontSize: '20px' }}>ðŸ“</span>
                                <span style={{ fontSize: '13px', fontWeight: '700', color: 'var(--text-primary)', textTransform: 'uppercase', letterSpacing: '0.5px' }}>WHAT DO YOU WANT TO MEASURE?</span>
                            </div>
                            <input 
                                type="text" 
                                className="input-field"
                                value={kpis.kpiLabel || ''} 
                                onChange={e => setKpis(prev => ({ ...prev, kpiLabel: e.target.value }))} 
                                placeholder="e.g., Weight (kg), Savings ($), Books Read, Hours Practiced..."
                                style={{ background: 'white', fontSize: '15px' }}
                            />
                            <p style={{ fontSize: '11px', color: 'var(--text-muted)', marginTop: '8px' }}>
                                ðŸ’¡ Examples: "Weight in kg", "Monthly savings in $", "Skills mastered", "Chapters completed"
                            </p>
                        </div>
                        
                        {/* Box 2 & 3: Current â†’ Target */}
                        <div style={{ display: 'flex', gap: '16px', flexWrap: 'wrap', alignItems: 'stretch' }}>
                            {/* Box 2: CURRENT */}
                            <div style={{ flex: 1, minWidth: '140px', background: 'rgba(212, 165, 165, 0.15)', borderRadius: '12px', padding: '16px', border: '2px solid rgba(212, 165, 165, 0.4)' }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '10px' }}>
                                    <span style={{ fontSize: '24px' }}>ðŸ“</span>
                                    <span style={{ fontSize: '14px', fontWeight: '700', color: 'var(--danger)', textTransform: 'uppercase' }}>CURRENT</span>
                                </div>
                                <p style={{ fontSize: '11px', color: 'var(--text-muted)', marginBottom: '10px' }}>Where you are NOW</p>
                                <input 
                                    type="number" 
                                    className="input-field"
                                    value={kpis.startValue || ''} 
                                    onChange={e => setKpis(prev => ({ ...prev, startValue: e.target.value }))} 
                                    placeholder="0"
                                    style={{ 
                                        background: 'white', 
                                        fontSize: '28px', 
                                        fontWeight: '700', 
                                        textAlign: 'center',
                                        padding: '16px',
                                        color: 'var(--danger)'
                                    }}
                                />
                            </div>
                            
                            {/* Arrow */}
                            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '32px', color: 'var(--accent-sage)', fontWeight: '700' }}>
                                â†’
                            </div>
                            
                            {/* Box 3: TARGET */}
                            <div style={{ flex: 1, minWidth: '140px', background: 'rgba(156, 175, 136, 0.15)', borderRadius: '12px', padding: '16px', border: '2px solid rgba(156, 175, 136, 0.4)' }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '10px' }}>
                                    <span style={{ fontSize: '24px' }}>ðŸŽ¯</span>
                                    <span style={{ fontSize: '14px', fontWeight: '700', color: 'var(--accent-sage)', textTransform: 'uppercase' }}>TARGET</span>
                                </div>
                                <p style={{ fontSize: '11px', color: 'var(--text-muted)', marginBottom: '10px' }}>Where you want to BE</p>
                                <input 
                                    type="number" 
                                    className="input-field"
                                    value={kpis.targetValue || ''} 
                                    onChange={e => setKpis(prev => ({ ...prev, targetValue: e.target.value }))} 
                                    placeholder="0"
                                    style={{ 
                                        background: 'white', 
                                        fontSize: '28px', 
                                        fontWeight: '700', 
                                        textAlign: 'center',
                                        padding: '16px',
                                        color: 'var(--accent-sage)'
                                    }}
                                />
                            </div>
                        </div>
                        
                        {/* Visual Journey Preview */}
                        {kpis.kpiLabel && kpis.startValue && kpis.targetValue && (
                            <div style={{ marginTop: '20px', padding: '16px', background: 'linear-gradient(135deg, rgba(212, 165, 165, 0.1), rgba(156, 175, 136, 0.1))', borderRadius: '12px', textAlign: 'center', border: '1px dashed var(--accent-sage)' }}>
                                <p style={{ fontSize: '12px', color: 'var(--text-muted)', marginBottom: '8px' }}>YOUR JOURNEY</p>
                                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '12px', flexWrap: 'wrap' }}>
                                    <div style={{ textAlign: 'center' }}>
                                        <span style={{ fontSize: '24px', fontWeight: '700', color: 'var(--danger)' }}>{kpis.startValue}</span>
                                        <p style={{ fontSize: '11px', color: 'var(--text-muted)' }}>{kpis.kpiLabel}</p>
                                    </div>
                                    <span style={{ fontSize: '20px', color: 'var(--accent-sage)' }}>â†’</span>
                                    <div style={{ textAlign: 'center' }}>
                                        <span style={{ fontSize: '24px', fontWeight: '700', color: 'var(--accent-sage)' }}>{kpis.targetValue}</span>
                                        <p style={{ fontSize: '11px', color: 'var(--text-muted)' }}>{kpis.kpiLabel}</p>
                                    </div>
                                    <div style={{ marginLeft: '12px', padding: '8px 12px', background: 'white', borderRadius: '8px' }}>
                                        <span style={{ fontSize: '14px', fontWeight: '600', color: 'var(--text-primary)' }}>
                                            {parseFloat(kpis.targetValue) > parseFloat(kpis.startValue) ? '+' : ''}{(parseFloat(kpis.targetValue) - parseFloat(kpis.startValue)).toFixed(1)} change
                                        </span>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                    
                    <button className="btn-primary" disabled={!name.trim() || !goal.trim() || !endDate} onClick={handleSubmit} style={{ width: '100%', marginTop: '24px' }}>
                        ðŸŒ± Create {cat.milestoneTemplates.length} Milestones
                    </button>
                </div>
            );
        };
        
        const MilestoneModal = ({ milestone, onClose, onSave, onShiftTimeline }) => {
            const isAlreadyResolved = milestone.status !== 'pending';
            const [status, setStatus] = useState(milestone.status);
            const [actualValue, setActualValue] = useState(milestone.actualValue || '');
            const [notes, setNotes] = useState(milestone.notes || '');
            const [wantsToShift, setWantsToShift] = useState(false);
            // NEW: Shift type - 'compress' keeps end date, 'extend' pushes end date
            const [shiftType, setShiftType] = useState('compress');
            
            // EDIT MODE for milestone details
            const [isEditMode, setIsEditMode] = useState(false);
            const [editTitle, setEditTitle] = useState(milestone.title);
            const [editDescription, setEditDescription] = useState(milestone.description || '');
            const [editKpiTarget, setEditKpiTarget] = useState(milestone.kpiTarget || '');
            const [editStartDate, setEditStartDate] = useState(milestone.startDate || milestone.targetDate);
            const [editEndDate, setEditEndDate] = useState(milestone.endDate || milestone.targetDate);
            const [editTips, setEditTips] = useState(milestone.tips || '');
            
            const today = getToday();
            const milestoneStartDate = isEditMode ? editStartDate : (milestone.startDate || milestone.targetDate);
            const milestoneEndDate = isEditMode ? editEndDate : (milestone.endDate || milestone.targetDate);
            const daysInMilestone = daysBetween(milestoneStartDate, milestoneEndDate);
            
            // Default new start date = MAX(milestone END date, today) - whichever is later
            const defaultNewStartDate = milestoneEndDate > today ? milestoneEndDate : today;
            const [newStartDate, setNewStartDate] = useState(defaultNewStartDate);
            
            const handleSaveEdits = () => {
                // Save edited milestone details
                const updatedMilestone = {
                    ...milestone,
                    title: editTitle,
                    description: editDescription,
                    kpiTarget: editKpiTarget,
                    startDate: editStartDate,
                    endDate: editEndDate,
                    targetDate: editEndDate, // Keep targetDate synced with endDate
                    tips: editTips
                };
                onSave(updatedMilestone);
                setIsEditMode(false);
            };
            
            const handleSave = () => {
                // If user wants to shift timeline for remaining milestones
                if (status === 'not-reached' && wantsToShift && newStartDate) {
                    // Pass shiftType: 'compress' or 'extend'
                    onShiftTimeline(milestone, newStartDate, actualValue, notes, shiftType);
                } else {
                    onSave({ ...milestone, status, actualValue, notes, completedAt: status !== 'pending' ? today : null });
                }
                onClose();
            };
            
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" onClick={e => e.stopPropagation()}>
                        <div className="modal-header">
                            <div style={{ flex: 1 }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '8px' }}>
                                    <span className={`milestone-type-badge ${milestone.type}`}>{milestone.type === 'major' ? 'â­ MAJOR' : 'ðŸ“‹ Minor'}</span>
                                    {!isEditMode && (
                                        <button 
                                            onClick={() => setIsEditMode(true)}
                                            style={{
                                                background: 'rgba(156, 175, 136, 0.15)',
                                                border: '1px solid var(--accent-sage)',
                                                borderRadius: '6px',
                                                padding: '4px 10px',
                                                fontSize: '11px',
                                                fontWeight: '600',
                                                color: 'var(--accent-sage)',
                                                cursor: 'pointer',
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '4px'
                                            }}
                                        >
                                            âœï¸ Edit
                                        </button>
                                    )}
                                </div>
                                {isEditMode ? (
                                    <input
                                        type="text"
                                        className="input-field"
                                        value={editTitle}
                                        onChange={e => setEditTitle(e.target.value)}
                                        placeholder="Milestone title..."
                                        style={{ fontSize: '16px', fontWeight: '600' }}
                                    />
                                ) : (
                                    <h3 style={{ marginTop: '0' }}>{milestone.title}</h3>
                                )}
                            </div>
                            <button className="close-btn" onClick={onClose} style={{ alignSelf: 'flex-start' }}>Ã—</button>
                        </div>
                        
                        <div className="modal-body">
                            {/* Inspirational Quote - hide when editing */}
                            {!isEditMode && milestone.quote && (
                                <div style={{ marginBottom: '20px', padding: '16px', background: 'linear-gradient(135deg, rgba(184,169,201,0.1), rgba(156,175,136,0.1))', borderRadius: 'var(--radius-sm)', borderLeft: '4px solid var(--accent-lavender)' }}>
                                    <p style={{ fontSize: '14px', color: 'var(--text-secondary)', fontStyle: 'italic', margin: 0, lineHeight: 1.6 }}>{milestone.quote}</p>
                                </div>
                            )}
                            
                            {/* Edit Mode - Full Edit Form */}
                            {isEditMode ? (
                                <div style={{ 
                                    background: 'rgba(156, 175, 136, 0.08)', 
                                    padding: '16px', 
                                    borderRadius: 'var(--radius-sm)', 
                                    marginBottom: '16px',
                                    border: '1px solid rgba(156, 175, 136, 0.2)'
                                }}>
                                    <p style={{ fontSize: '13px', fontWeight: '600', color: 'var(--accent-sage)', marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '6px' }}>
                                        âœï¸ Edit Milestone Details
                                    </p>
                                    
                                    {/* Dates Row */}
                                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px', marginBottom: '16px' }}>
                                        <div>
                                            <label className="form-label" style={{ fontSize: '12px' }}>Start Date</label>
                                            <input 
                                                type="date" 
                                                className="input-field" 
                                                value={editStartDate}
                                                onChange={e => setEditStartDate(e.target.value)}
                                            />
                                        </div>
                                        <div>
                                            <label className="form-label" style={{ fontSize: '12px' }}>End Date</label>
                                            <input 
                                                type="date" 
                                                className="input-field" 
                                                value={editEndDate}
                                                onChange={e => setEditEndDate(e.target.value)}
                                            />
                                        </div>
                                    </div>
                                    
                                    {/* Warning if dates overlap or are inverted */}
                                    {editStartDate > editEndDate && (
                                        <div style={{ 
                                            background: 'rgba(212, 165, 165, 0.15)', 
                                            padding: '8px 12px', 
                                            borderRadius: '6px', 
                                            marginBottom: '12px',
                                            fontSize: '12px',
                                            color: 'var(--danger)'
                                        }}>
                                            âš ï¸ Start date is after end date. Please correct.
                                        </div>
                                    )}
                                    
                                    {/* Info about overlap */}
                                    <p style={{ fontSize: '11px', color: 'var(--text-muted)', marginBottom: '12px', fontStyle: 'italic' }}>
                                        ðŸ’¡ Overlapping dates with other milestones is allowed - you decide your schedule!
                                    </p>
                                    
                                    {/* KPI Target */}
                                    <div className="form-group" style={{ marginBottom: '12px' }}>
                                        <label className="form-label" style={{ fontSize: '12px' }}>KPI Target</label>
                                        <input 
                                            type="text" 
                                            className="input-field" 
                                            value={editKpiTarget}
                                            onChange={e => setEditKpiTarget(e.target.value)}
                                            placeholder={`Target ${milestone.kpiUnit || 'value'}...`}
                                        />
                                    </div>
                                    
                                    {/* Description */}
                                    <div className="form-group" style={{ marginBottom: '12px' }}>
                                        <label className="form-label" style={{ fontSize: '12px' }}>Description</label>
                                        <textarea 
                                            className="input-field" 
                                            value={editDescription}
                                            onChange={e => setEditDescription(e.target.value)}
                                            placeholder="What does this milestone involve?"
                                            rows={2}
                                        />
                                    </div>
                                    
                                    {/* Tips */}
                                    <div className="form-group" style={{ marginBottom: '16px' }}>
                                        <label className="form-label" style={{ fontSize: '12px' }}>Tips & Suggestions</label>
                                        <textarea 
                                            className="input-field" 
                                            value={editTips}
                                            onChange={e => setEditTips(e.target.value)}
                                            placeholder="What strategies will help you achieve this?"
                                            rows={2}
                                        />
                                    </div>
                                    
                                    {/* Edit Actions */}
                                    <div style={{ display: 'flex', gap: '8px', justifyContent: 'flex-end' }}>
                                        <button 
                                            className="btn-secondary" 
                                            onClick={() => {
                                                // Reset to original values
                                                setEditTitle(milestone.title);
                                                setEditDescription(milestone.description || '');
                                                setEditKpiTarget(milestone.kpiTarget || '');
                                                setEditStartDate(milestone.startDate || milestone.targetDate);
                                                setEditEndDate(milestone.endDate || milestone.targetDate);
                                                setEditTips(milestone.tips || '');
                                                setIsEditMode(false);
                                            }}
                                            style={{ fontSize: '13px', padding: '8px 16px' }}
                                        >
                                            Cancel
                                        </button>
                                        <button 
                                            className="btn-primary" 
                                            onClick={handleSaveEdits}
                                            disabled={editStartDate > editEndDate}
                                            style={{ fontSize: '13px', padding: '8px 16px' }}
                                        >
                                            ðŸ’¾ Save Changes
                                        </button>
                                    </div>
                                </div>
                            ) : (
                                <>
                                    {/* Milestone dates - View Mode */}
                                    <div style={{ 
                                        display: 'grid', 
                                        gridTemplateColumns: '1fr 1fr', 
                                        gap: '12px', 
                                        marginBottom: '16px',
                                        padding: '12px',
                                        background: 'var(--bg-secondary)',
                                        borderRadius: 'var(--radius-sm)'
                                    }}>
                                        <div>
                                            <p style={{ fontSize: '11px', color: 'var(--text-muted)', marginBottom: '4px' }}>START DATE</p>
                                            <p style={{ fontSize: '14px', fontWeight: '600', color: 'var(--text-primary)' }}>{formatDateFull(milestoneStartDate)}</p>
                                        </div>
                                        <div>
                                            <p style={{ fontSize: '11px', color: 'var(--text-muted)', marginBottom: '4px' }}>END DATE</p>
                                            <p style={{ fontSize: '14px', fontWeight: '600', color: 'var(--text-primary)' }}>{formatDateFull(milestoneEndDate)}</p>
                                        </div>
                                    </div>
                                    <p style={{ color: 'var(--text-secondary)', fontSize: '13px', marginBottom: '8px' }}>ðŸ“… {daysInMilestone} days of focused work</p>
                                    <p style={{ color: 'var(--accent-sage)', fontWeight: '600', marginBottom: '24px' }}>ðŸŽ¯ KPI Target: {milestone.kpiTarget} {milestone.kpiUnit}</p>
                                </>
                            )}
                            
                            {/* View-only mode for already resolved milestones - Hide when editing */}
                            {!isEditMode && isAlreadyResolved ? (
                                <div style={{ background: milestone.status === 'completed' ? 'rgba(125,155,118,0.1)' : 'rgba(212,165,165,0.1)', padding: '20px', borderRadius: 'var(--radius-sm)', marginBottom: '16px' }}>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '12px' }}>
                                        <span style={{ fontSize: '32px' }}>{milestone.status === 'completed' ? 'âœ…' : 'âŒ'}</span>
                                        <div>
                                            <p style={{ fontWeight: '600', fontSize: '16px', color: milestone.status === 'completed' ? 'var(--success)' : 'var(--danger)' }}>
                                                {milestone.status === 'completed' ? 'Milestone Reached!' : 'Milestone Not Reached'}
                                            </p>
                                            {milestone.completedAt && <p style={{ fontSize: '12px', color: 'var(--text-muted)' }}>Recorded on {formatDateFull(milestone.completedAt)}</p>}
                                        </div>
                                    </div>
                                    {milestone.actualValue && (
                                        <p style={{ fontSize: '14px', color: 'var(--text-secondary)' }}>
                                            <strong>Actual Value:</strong> {milestone.actualValue} {milestone.kpiUnit}
                                        </p>
                                    )}
                                    {milestone.notes && (
                                        <p style={{ fontSize: '14px', color: 'var(--text-secondary)', marginTop: '8px', fontStyle: 'italic' }}>
                                            "{milestone.notes}"
                                        </p>
                                    )}
                                </div>
                            ) : !isEditMode && (
                                <>
                                    <div className="form-group">
                                        <label className="form-label">Your Actual Value</label>
                                        <input type="text" className="input-field" placeholder={`Enter actual ${milestone.kpiUnit} achieved...`} value={actualValue} onChange={e => setActualValue(e.target.value)} />
                                    </div>
                                    
                                    <div className="form-group">
                                        <label className="form-label">Did you reach this milestone?</label>
                                        <div style={{ display: 'flex', gap: '12px', marginTop: '8px' }}>
                                            <button className="btn-secondary" style={status === 'completed' ? { borderColor: 'var(--success)', background: 'rgba(125,155,118,0.15)', flex: 1 } : { flex: 1 }} onClick={() => { setStatus('completed'); setWantsToShift(false); }}>
                                                âœ… REACHED
                                            </button>
                                            <button className="btn-secondary" style={status === 'not-reached' ? { borderColor: 'var(--danger)', background: 'rgba(212,165,165,0.15)', flex: 1 } : { flex: 1 }} onClick={() => setStatus('not-reached')}>
                                                âŒ NOT REACHED
                                            </button>
                                        </div>
                                    </div>
                                </>
                            )}
                            
                            {/* Timeline Shift Option - only shown when NOT REACHED and not already resolved and not editing */}
                            {!isEditMode && !isAlreadyResolved && status === 'not-reached' && (
                                <div style={{ background: 'rgba(212,165,165,0.1)', padding: '16px', borderRadius: 'var(--radius-sm)', marginTop: '16px', border: '1px solid rgba(212,165,165,0.3)' }}>
                                    <p style={{ fontSize: '14px', fontWeight: '600', color: 'var(--danger)', marginBottom: '12px' }}>
                                        âš ï¸ You missed this milestone. What would you like to do?
                                    </p>
                                    
                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                                        <label style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer' }}>
                                            <input type="radio" name="shiftChoice" checked={!wantsToShift} onChange={() => setWantsToShift(false)} />
                                            <span style={{ fontSize: '13px' }}>Keep timeline as is (accept the miss)</span>
                                        </label>
                                        <label style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer' }}>
                                            <input type="radio" name="shiftChoice" checked={wantsToShift} onChange={() => setWantsToShift(true)} />
                                            <span style={{ fontSize: '13px' }}>Shift remaining milestones to new dates</span>
                                        </label>
                                    </div>
                                    
                                    {wantsToShift && (
                                        <div style={{ marginTop: '16px' }}>
                                            {/* New start date */}
                                            <label className="form-label" style={{ fontSize: '13px' }}>
                                                New start date for remaining milestones
                                            </label>
                                            <p style={{ fontSize: '11px', color: 'var(--text-muted)', marginBottom: '8px' }}>
                                                Default: {milestoneEndDate > today 
                                                    ? `This milestone's end date (${formatDate(milestoneEndDate)})`
                                                    : `Today (${formatDate(today)})`
                                                }
                                            </p>
                                            <input 
                                                type="date" 
                                                className="input-field" 
                                                value={newStartDate} 
                                                min={today}
                                                onChange={e => setNewStartDate(e.target.value)} 
                                            />
                                            
                                            {/* Shift type options */}
                                            <div style={{ marginTop: '16px' }}>
                                                <label className="form-label" style={{ fontSize: '13px', marginBottom: '12px' }}>
                                                    How do you want to adjust the timeline?
                                                </label>
                                                
                                                {/* Option 1: Keep end date (compress) */}
                                                <div 
                                                    onClick={() => setShiftType('compress')}
                                                    style={{ 
                                                        padding: '12px', 
                                                        marginBottom: '8px',
                                                        borderRadius: 'var(--radius-sm)',
                                                        border: shiftType === 'compress' ? '2px solid var(--accent-sage)' : '1px solid rgba(0,0,0,0.1)',
                                                        background: shiftType === 'compress' ? 'rgba(156, 175, 136, 0.1)' : 'white',
                                                        cursor: 'pointer'
                                                    }}
                                                >
                                                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                                        <input type="radio" checked={shiftType === 'compress'} onChange={() => setShiftType('compress')} />
                                                        <div>
                                                            <p style={{ fontSize: '13px', fontWeight: '600', margin: 0 }}>ðŸ“† Keep original target date</p>
                                                            <p style={{ fontSize: '11px', color: 'var(--text-muted)', margin: '4px 0 0 0' }}>
                                                                Compress milestones to fit within the original end date. Work harder, finish on time!
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                {/* Option 2: Extend end date */}
                                                <div 
                                                    onClick={() => setShiftType('extend')}
                                                    style={{ 
                                                        padding: '12px',
                                                        borderRadius: 'var(--radius-sm)',
                                                        border: shiftType === 'extend' ? '2px solid var(--accent-lavender)' : '1px solid rgba(0,0,0,0.1)',
                                                        background: shiftType === 'extend' ? 'rgba(184, 169, 201, 0.1)' : 'white',
                                                        cursor: 'pointer'
                                                    }}
                                                >
                                                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                                        <input type="radio" checked={shiftType === 'extend'} onChange={() => setShiftType('extend')} />
                                                        <div>
                                                            <p style={{ fontSize: '13px', fontWeight: '600', margin: 0 }}>ðŸ“… Extend target date</p>
                                                            <p style={{ fontSize: '11px', color: 'var(--text-muted)', margin: '4px 0 0 0' }}>
                                                                Keep same duration per milestone, but push the final target date forward.
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            {/* Summary */}
                                            <div style={{ 
                                                marginTop: '12px', 
                                                padding: '12px', 
                                                background: shiftType === 'compress' ? 'rgba(156, 175, 136, 0.1)' : 'rgba(184, 169, 201, 0.1)', 
                                                borderRadius: 'var(--radius-sm)',
                                                border: `1px solid ${shiftType === 'compress' ? 'rgba(156, 175, 136, 0.3)' : 'rgba(184, 169, 201, 0.3)'}`
                                            }}>
                                                <p style={{ fontSize: '12px', color: 'var(--text-secondary)', marginBottom: '4px' }}>
                                                    ðŸ“Œ <strong>Summary:</strong>
                                                </p>
                                                <p style={{ fontSize: '11px', color: 'var(--text-muted)', margin: 0 }}>
                                                    {shiftType === 'compress' 
                                                        ? `Milestones will be compressed to fit between ${formatDate(newStartDate)} and your original target date.`
                                                        : `Each milestone keeps its original duration. End date will be extended.`
                                                    }
                                                </p>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}
                            
                            {/* Notes - only for pending milestones and not editing */}
                            {!isEditMode && !isAlreadyResolved && (
                                <div className="form-group" style={{ marginTop: '16px' }}>
                                    <label className="form-label">Notes (optional)</label>
                                    <textarea className="input-field" placeholder="What happened? How do you feel?" value={notes} onChange={e => setNotes(e.target.value)} rows={2} />
                                </div>
                            )}
                            
                            {/* Info box - only for pending milestones and not editing */}
                            {!isEditMode && !isAlreadyResolved && (
                                <div style={{ background: 'var(--bg-secondary)', padding: '16px', borderRadius: 'var(--radius-sm)', marginTop: '16px' }}>
                                    <p style={{ fontSize: '13px', color: 'var(--text-secondary)' }}>
                                        {status === 'completed' 
                                            ? 'âœ… This milestone will add to your compound growth multiplier!'
                                            : status === 'not-reached' && wantsToShift && shiftType === 'compress'
                                            ? 'ðŸ“† Milestone = MISSED. Remaining milestones will be compressed to fit your original end date.'
                                            : status === 'not-reached' && wantsToShift && shiftType === 'extend'
                                            ? 'ðŸ“… Milestone = MISSED. Timeline will be extended to keep milestone duration the same.'
                                            : status === 'not-reached'
                                            ? 'âŒ Missing this milestone reduces your compound growth potential.'
                                            : 'â³ Select REACHED or NOT REACHED to update your progress.'
                                        }
                                    </p>
                                </div>
                            )}
                        </div>
                        
                        <div className="modal-footer">
                            {isEditMode ? (
                                /* Edit mode - footer is handled inside the edit form above */
                                <button className="btn-secondary" onClick={onClose}>Close</button>
                            ) : isAlreadyResolved ? (
                                <button className="btn-primary" onClick={onClose}>Close</button>
                            ) : (
                                <>
                                    <button className="btn-secondary" onClick={onClose}>Cancel</button>
                                    <button className="btn-primary" onClick={handleSave} disabled={status === 'pending'}>
                                        {status === 'not-reached' && wantsToShift ? 'Save & Shift Timeline' : 'Save Milestone'}
                                    </button>
                                </>
                            )}
                        </div>
                    </div>
                </div>
            );
        };
        
        // Firework Celebration Component
        const FireworkCelebration = ({ show, onComplete, type = 'major' }) => {
            const [particles, setParticles] = useState([]);
            const [confetti, setConfetti] = useState([]);
            
            useEffect(() => {
                if (show) {
                    // Generate firework particles
                    const colors = type === 'complete' 
                        ? ['#FFD700', '#FF6B6B', '#4ECDC4', '#A855F7', '#10B981', '#F59E0B']
                        : ['#c9a86c', '#9caf88', '#b8a9c9'];
                    
                    const newParticles = [];
                    const newConfetti = [];
                    
                    // Create multiple burst points
                    const burstPoints = type === 'complete' ? 5 : 3;
                    for (let b = 0; b < burstPoints; b++) {
                        const centerX = 20 + Math.random() * 60;
                        const centerY = 20 + Math.random() * 40;
                        
                        for (let i = 0; i < 12; i++) {
                            const angle = (i / 12) * Math.PI * 2;
                            const distance = 50 + Math.random() * 100;
                            newParticles.push({
                                id: `p_${b}_${i}`,
                                x: centerX,
                                y: centerY,
                                endX: centerX + Math.cos(angle) * distance,
                                endY: centerY + Math.sin(angle) * distance,
                                color: colors[Math.floor(Math.random() * colors.length)],
                                delay: b * 0.3
                            });
                        }
                    }
                    
                    // Create confetti
                    for (let i = 0; i < (type === 'complete' ? 50 : 20); i++) {
                        newConfetti.push({
                            id: `c_${i}`,
                            x: Math.random() * 100,
                            color: colors[Math.floor(Math.random() * colors.length)],
                            delay: Math.random() * 1,
                            shape: Math.random() > 0.5 ? 'â– ' : 'â—'
                        });
                    }
                    
                    setParticles(newParticles);
                    setConfetti(newConfetti);
                    
                    // Clear after animation
                    setTimeout(() => {
                        setParticles([]);
                        setConfetti([]);
                        if (onComplete) onComplete();
                    }, type === 'complete' ? 4000 : 2500);
                }
            }, [show, type, onComplete]);
            
            if (!show || (particles.length === 0 && confetti.length === 0)) return null;
            
            return (
                <div className="firework-overlay">
                    {particles.map(p => (
                        <div
                            key={p.id}
                            className="firework-particle"
                            style={{
                                left: `${p.x}%`,
                                top: `${p.y}%`,
                                background: p.color,
                                animationDelay: `${p.delay}s`,
                                '--end-x': `${p.endX - p.x}vw`,
                                '--end-y': `${p.endY - p.y}vh`
                            }}
                        />
                    ))}
                    {confetti.map(c => (
                        <div
                            key={c.id}
                            className="confetti"
                            style={{
                                left: `${c.x}%`,
                                color: c.color,
                                animationDelay: `${c.delay}s`,
                                fontSize: '14px'
                            }}
                        >
                            {c.shape}
                        </div>
                    ))}
                </div>
            );
        };
        
        // Get reward for milestone based on type and status
        const getMilestoneReward = (milestone, index) => {
            if (milestone.status !== 'completed') return null;
            
            const isMajor = milestone.type === 'major';
            const isRetry = milestone.isRetry === true;
            
            // Varying rewards based on milestone properties
            if (isMajor) {
                // Trophy cups for major milestones - varying styles
                const trophies = ['ðŸ†', 'ðŸ¥‡', 'ðŸ‘‘', 'ðŸŽ–ï¸', 'ðŸ…'];
                return {
                    emoji: trophies[index % trophies.length],
                    className: 'trophy',
                    label: 'Major Achievement!'
                };
            } else if (isRetry) {
                // Special reward for recovery
                return {
                    emoji: 'ðŸ’ª',
                    className: 'star',
                    label: 'Comeback!'
                };
            } else {
                // Stars and smileys for minor milestones
                const rewards = ['â­', 'ðŸŒŸ', 'âœ¨', 'ðŸ˜Š', 'ðŸŽ¯', 'ðŸ’«'];
                return {
                    emoji: rewards[index % rewards.length],
                    className: 'star',
                    label: 'Well done!'
                };
            }
        };
        
        // Milestone-based Progress Tab with DAYS tracking and REWARDS
        const MilestoneProgressTab = ({ milestones, compound: rawCompound, journeyStatus, recoveryStats }) => {
            const today = getToday();
            const [showFirework, setShowFirework] = useState(false);
            const [fireworkType, setFireworkType] = useState('major');
            const [celebrationShown, setCelebrationShown] = useState({});
            
            // Safety checks for empty/null data
            const safeMilestones = milestones || [];
            const compound = rawCompound || {
                milestonesWithDays: [], potentialX: '1.00', idealX: '1.00', actualX: '1.00', lostX: '0.00',
                totalDaysWorked: 0, daysElapsed: 0, daysMissed: 0, totalDaysInJourney: 365,
                reached: 0, missed: 0, pending: 0, total: 0, streakDays: 0,
                daysToNextMilestone: 0, perMilestoneMultiplier: '1.00'
            };
            
            // Use milestones with days info from compound
            const sorted = compound.milestonesWithDays && compound.milestonesWithDays.length > 0 
                ? compound.milestonesWithDays 
                : [...safeMilestones].sort((a, b) => new Date(a.targetDate || 0) - new Date(b.targetDate || 0));
            
            // Calculate bar widths based on X values
            const potentialX = parseFloat(compound.potentialX) || 1;
            const idealX = parseFloat(compound.idealX) || 1;
            const actualX = parseFloat(compound.actualX) || 1;
            const actualBarWidth = potentialX > 1 ? Math.min(100, ((actualX - 1) / (potentialX - 1)) * 100) : 0;
            const idealBarWidth = potentialX > 1 ? Math.min(100, ((idealX - 1) / (potentialX - 1)) * 100) : 0;
            
            // Recovery stats
            const { failedMilestones = 0, recoveredFailures = 0, unrecoveredFailures = 0 } = recoveryStats || {};
            
            // Check if all milestones are complete (for celebration)
            const allComplete = compound.pending === 0 && compound.reached > 0;
            const completedMajors = sorted.filter(m => m.type === 'major' && m.status === 'completed').length;
            const totalMajors = sorted.filter(m => m.type === 'major').length;
            const allMajorsComplete = completedMajors === totalMajors && totalMajors > 0;
            
            // Trigger celebration when entering page with all complete
            useEffect(() => {
                if (allComplete && !celebrationShown.allComplete) {
                    setFireworkType('complete');
                    setShowFirework(true);
                    setCelebrationShown(prev => ({ ...prev, allComplete: true }));
                }
            }, [allComplete, celebrationShown.allComplete]);
            
            return (
                <div className="card">
                    {/* Firework Celebration */}
                    <FireworkCelebration 
                        show={showFirework} 
                        type={fireworkType}
                        onComplete={() => setShowFirework(false)}
                    />
                    
                    {/* All Complete Celebration Banner */}
                    {allComplete && (
                        <div style={{
                            background: 'linear-gradient(135deg, rgba(201, 168, 108, 0.2), rgba(156, 175, 136, 0.15))',
                            border: '2px solid var(--accent-gold)',
                            borderRadius: 'var(--radius-md)',
                            padding: '20px',
                            marginBottom: '20px',
                            textAlign: 'center',
                            position: 'relative',
                            overflow: 'hidden'
                        }}>
                            {/* Decorative stars */}
                            <div style={{ position: 'absolute', top: '10px', left: '20px', fontSize: '20px', animation: 'star-spin 3s linear infinite' }}>â­</div>
                            <div style={{ position: 'absolute', top: '10px', right: '20px', fontSize: '20px', animation: 'star-spin 3s linear infinite', animationDelay: '1s' }}>ðŸŒŸ</div>
                            <div style={{ position: 'absolute', bottom: '10px', left: '30px', fontSize: '16px', animation: 'star-spin 3s linear infinite', animationDelay: '0.5s' }}>âœ¨</div>
                            <div style={{ position: 'absolute', bottom: '10px', right: '30px', fontSize: '16px', animation: 'star-spin 3s linear infinite', animationDelay: '1.5s' }}>ðŸ’«</div>
                            
                            <div style={{ fontSize: '48px', marginBottom: '12px' }}>ðŸŽ‰ðŸ†ðŸŽ‰</div>
                            <h3 style={{ color: 'var(--accent-gold)', marginBottom: '8px', fontSize: '20px' }}>
                                CONGRATULATIONS! Journey Complete!
                            </h3>
                            <p style={{ color: 'var(--text-secondary)', fontSize: '14px', marginBottom: '12px' }}>
                                {compound.totalDaysWorked} days of 1% improvement = 1.01^{compound.totalDaysWorked} = {compound.actualX}X growth!
                            </p>
                            <div style={{ display: 'flex', justifyContent: 'center', gap: '16px', flexWrap: 'wrap' }}>
                                <span style={{ background: 'var(--accent-gold)', color: 'white', padding: '6px 14px', borderRadius: '20px', fontSize: '12px', fontWeight: '600' }}>
                                    ðŸ† {completedMajors} Major Achievements
                                </span>
                                <span style={{ background: 'var(--success)', color: 'white', padding: '6px 14px', borderRadius: '20px', fontSize: '12px', fontWeight: '600' }}>
                                    ðŸ“… {compound.totalDaysWorked} Days of Dedication
                                </span>
                                <span style={{ background: 'var(--accent-lavender)', color: 'white', padding: '6px 14px', borderRadius: '20px', fontSize: '12px', fontWeight: '600' }}>
                                    ðŸ”¥ {compound.streakDays} Day Streak
                                </span>
                            </div>
                            
                            {/* Replay celebration button */}
                            <button 
                                onClick={() => {
                                    setFireworkType('complete');
                                    setShowFirework(true);
                                }}
                                style={{
                                    marginTop: '16px',
                                    background: 'transparent',
                                    border: '1px solid var(--accent-gold)',
                                    color: 'var(--accent-gold)',
                                    padding: '8px 16px',
                                    borderRadius: '20px',
                                    cursor: 'pointer',
                                    fontSize: '12px',
                                    fontWeight: '600'
                                }}
                            >
                                ðŸŽ† Celebrate Again!
                            </button>
                        </div>
                    )}
                    
                    <h3 style={{ marginBottom: '8px' }}>ðŸ“ˆ Growth Tracker</h3>
                    
                    {/* Journey Status in Growth Tracker */}
                    {journeyStatus && (
                        <div style={{ 
                            background: `linear-gradient(135deg, ${journeyStatus.color}12, ${journeyStatus.color}06)`,
                            border: `1px solid ${journeyStatus.color}30`,
                            borderRadius: 'var(--radius-sm)',
                            padding: '14px',
                            marginBottom: '20px'
                        }}>
                            <div style={{ display: 'flex', alignItems: 'flex-start', gap: '10px' }}>
                                <span style={{ fontSize: '22px' }}>{journeyStatus.emoji}</span>
                                <div style={{ flex: 1 }}>
                                    <p style={{ fontWeight: '600', fontSize: '14px', color: journeyStatus.color, margin: 0 }}>
                                        {journeyStatus.status}
                                    </p>
                                    <p style={{ fontSize: '12px', color: 'var(--text-secondary)', margin: '4px 0 0 0', lineHeight: 1.5 }}>
                                        {journeyStatus.note}
                                    </p>
                                </div>
                            </div>
                            {/* Recovery Legend */}
                            {failedMilestones > 0 && (
                                <div style={{ 
                                    display: 'flex', 
                                    gap: '12px', 
                                    marginTop: '10px',
                                    paddingTop: '10px',
                                    borderTop: `1px solid ${journeyStatus.color}20`,
                                    fontSize: '11px'
                                }}>
                                    <span style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>
                                        <span style={{ width: '8px', height: '8px', borderRadius: '50%', background: 'var(--danger)', display: 'inline-block' }}></span>
                                        {failedMilestones} Setback{failedMilestones > 1 ? 's' : ''}
                                    </span>
                                    <span style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>
                                        <span style={{ width: '8px', height: '8px', borderRadius: '50%', background: 'var(--success)', display: 'inline-block' }}></span>
                                        {recoveredFailures} Recovered
                                    </span>
                                    {unrecoveredFailures > 0 && (
                                        <span style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>
                                            <span style={{ width: '8px', height: '8px', borderRadius: '50%', background: 'var(--warning)', display: 'inline-block' }}></span>
                                            {unrecoveredFailures} Pending
                                        </span>
                                    )}
                                </div>
                            )}
                        </div>
                    )}
                    
                    <p style={{ color: 'var(--text-secondary)', marginBottom: '24px', fontSize: '14px' }}>
                        Each milestone = {compound.perMilestoneMultiplier}X growth. Days worked = your streak!
                    </p>
                    
                    <div className="stats-grid" style={{ marginBottom: '24px' }}>
                        <div className="stat-card">
                            <div className="stat-value">{compound.totalDaysWorked || 0}</div>
                            <div className="stat-label">Days Worked ðŸ“…</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value" style={{ color: 'var(--warning)' }}>{compound.streakDays || 0}</div>
                            <div className="stat-label">Day Streak ðŸ”¥</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value">{compound.reached}/{compound.total}</div>
                            <div className="stat-label">Milestones âœ…</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value" style={{ color: 'var(--accent-lavender)' }}>{compound.totalDaysInJourney || 0}</div>
                            <div className="stat-label">Total Days</div>
                        </div>
                    </div>
                    
                    {/* Milestone Timeline with Days and REWARDS */}
                    <div style={{ marginBottom: '24px' }}>
                        <h4 style={{ fontSize: '14px', marginBottom: '12px', color: 'var(--text-secondary)' }}>
                            ðŸ“… Milestone Timeline (Start â†’ End) 
                            {compound.reached > 0 && <span style={{ marginLeft: '8px', color: 'var(--accent-gold)' }}>ðŸ† {compound.reached} Rewarded!</span>}
                        </h4>
                        <div className="daily-grid" style={{ gridTemplateColumns: 'repeat(4, 1fr)', gap: '12px' }}>
                            {sorted.map((m, idx) => {
                                const isCurrent = m.status === 'pending' && (!sorted[idx - 1] || sorted[idx - 1].status !== 'pending');
                                const daysInPeriod = m.daysInPeriod || 0;
                                const mStart = m.startDate || m.targetDate;
                                const mEnd = m.endDate || m.targetDate;
                                const reward = getMilestoneReward(m, idx);
                                
                                return (
                                    <div 
                                        key={m.id} 
                                        className={`daily-cell ${m.status === 'completed' ? 'achieved' : m.status === 'not-reached' ? 'missed' : 'pending'}`}
                                        title={`${m.title}\n${daysInPeriod} days of work\nStart: ${formatDate(mStart)}\nEnd: ${formatDate(mEnd)}\nStatus: ${m.status}${reward ? `\nðŸŽ ${reward.label}` : ''}`}
                                        style={{
                                            padding: '12px 8px',
                                            position: 'relative',
                                            ...(isCurrent ? { boxShadow: '0 0 0 2px var(--accent-gold)' } : {}),
                                            ...(m.type === 'major' && m.status === 'completed' ? { 
                                                border: '2px solid var(--accent-gold)',
                                                background: 'linear-gradient(135deg, rgba(201, 168, 108, 0.15), rgba(156, 175, 136, 0.1))'
                                            } : m.type === 'major' ? { 
                                                border: '2px solid var(--accent-sage)' 
                                            } : {})
                                        }}
                                    >
                                        {/* Reward Badge */}
                                        {reward && (
                                            <div 
                                                className={`reward-badge ${reward.className}`}
                                                style={{
                                                    position: 'absolute',
                                                    top: '-10px',
                                                    right: '-10px',
                                                    fontSize: m.type === 'major' ? '22px' : '16px',
                                                    zIndex: 5,
                                                    filter: 'drop-shadow(0 2px 4px rgba(0,0,0,0.2))'
                                                }}
                                                title={reward.label}
                                            >
                                                {reward.emoji}
                                            </div>
                                        )}
                                        
                                        {/* Major milestone crown indicator */}
                                        {m.type === 'major' && (
                                            <span style={{ 
                                                position: 'absolute', 
                                                top: '-6px', 
                                                left: '50%', 
                                                transform: 'translateX(-50%)',
                                                fontSize: '10px',
                                                background: 'var(--accent-gold)',
                                                color: 'white',
                                                padding: '1px 6px',
                                                borderRadius: '8px',
                                                fontWeight: '700'
                                            }}>
                                                MAJOR
                                            </span>
                                        )}
                                        
                                        <span className="day-num" style={{ fontSize: '11px', fontWeight: '600', marginTop: m.type === 'major' ? '6px' : '0' }}>M{idx + 1}</span>
                                        <span style={{ fontSize: '18px' }}>
                                            {m.status === 'completed' ? (m.type === 'major' ? 'ðŸ†' : 'âœ…') : m.status === 'not-reached' ? 'âŒ' : 'â³'}
                                        </span>
                                        <span style={{ fontSize: '12px', fontWeight: '600', color: m.status === 'completed' ? 'var(--success)' : 'var(--text-muted)', marginTop: '2px' }}>
                                            {daysInPeriod}d
                                        </span>
                                        <span style={{ fontSize: '8px', color: 'var(--text-muted)', marginTop: '2px' }}>
                                            {formatDate(mStart)} â†’ {formatDate(mEnd)}
                                        </span>
                                        
                                        {/* Smiley for completed */}
                                        {m.status === 'completed' && !m.type === 'major' && (
                                            <span style={{ fontSize: '12px', marginTop: '4px' }}>ðŸ˜Š</span>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                    
                    {/* Rewards Legend */}
                    <div style={{ 
                        display: 'flex', 
                        gap: '16px', 
                        flexWrap: 'wrap',
                        padding: '12px 16px',
                        background: 'var(--bg-secondary)',
                        borderRadius: 'var(--radius-sm)',
                        marginBottom: '24px',
                        fontSize: '12px'
                    }}>
                        <span style={{ fontWeight: '600', color: 'var(--text-muted)' }}>ðŸŽ Rewards:</span>
                        <span>ðŸ† Major Milestone</span>
                        <span>â­ Completed</span>
                        <span>ðŸ’ª Comeback</span>
                        <span>ðŸ˜Š Well Done</span>
                    </div>
                    
                    <div className="compound-chart">
                        <h4 style={{ marginBottom: '12px' }}>ðŸ“Š The 1% Daily Compounding Effect</h4>
                        <p style={{ fontSize: '12px', color: 'var(--text-muted)', marginBottom: '8px' }}>
                            <strong>1.01^{compound.totalDaysInJourney} days = {compound.potentialX}X</strong> â€” 1% improvement every day!
                        </p>
                        <p style={{ fontSize: '11px', color: 'var(--text-muted)', marginBottom: '16px' }}>
                            You've worked <strong>{compound.totalDaysWorked} days</strong> out of {compound.daysElapsed || 0} elapsed days
                            {compound.daysMissed > 0 && <span style={{ color: 'var(--danger)' }}> ({compound.daysMissed} days missed)</span>}
                        </p>
                        
                        <div className="compound-row">
                            <span className="compound-label">Full Potential (1.01^{compound.totalDaysInJourney} days):</span>
                            <div className="compound-bar-container">
                                <div className="compound-bar ideal" style={{ width: '100%' }}>{compound.potentialX}X</div>
                            </div>
                        </div>
                        
                        {compound.daysElapsed > 0 && (
                            <div className="compound-row">
                                <span className="compound-label">Should be (1.01^{compound.daysElapsed} days elapsed):</span>
                                <div className="compound-bar-container">
                                    <div className="compound-bar" style={{ width: `${idealBarWidth}%`, background: 'var(--accent-lavender)' }}>
                                        {compound.idealX}X
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        <div className="compound-row">
                            <span className="compound-label">Your Reality (1.01^{compound.totalDaysWorked} days worked):</span>
                            <div className="compound-bar-container">
                                <div className="compound-bar actual" style={{ width: `${Math.max(5, actualBarWidth)}%` }}>
                                    {compound.actualX}X
                                </div>
                            </div>
                        </div>
                        
                        {compound.daysMissed > 0 && parseFloat(compound.lostX) > 0 && (
                            <div className="compound-row">
                                <span className="compound-label" style={{ color: 'var(--danger)' }}>Growth Lost ({compound.daysMissed} days missed):</span>
                                <div className="compound-bar-container">
                                    <div className="compound-bar lost" style={{ width: `${Math.min(100, (parseFloat(compound.lostX) / (potentialX - 1)) * 100)}%` }}>
                                        -{compound.lostX}X
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        <div style={{ marginTop: '16px', padding: '16px', background: 'white', borderRadius: 'var(--radius-sm)', fontSize: '14px' }}>
                            {compound.reached === compound.total ? (
                                <p style={{ color: 'var(--success)' }}>
                                    ðŸŽ‰ <strong>Incredible!</strong> {compound.totalDaysWorked} days of 1% improvement = {compound.actualX}X growth!
                                </p>
                            ) : compound.totalDaysWorked >= compound.daysElapsed && compound.daysElapsed > 0 ? (
                                <p style={{ color: 'var(--success)' }}>
                                    ðŸŽ¯ <strong>Perfect Streak!</strong> {compound.totalDaysWorked}/{compound.daysElapsed} days worked = 1.01^{compound.totalDaysWorked} = {compound.actualX}X!
                                </p>
                            ) : compound.totalDaysWorked > 0 ? (
                                <p style={{ color: compound.daysMissed > 0 ? 'var(--warning)' : 'var(--success)' }}>
                                    ðŸ“ˆ <strong>{compound.totalDaysWorked} days worked</strong> = 1.01^{compound.totalDaysWorked} = {compound.actualX}X
                                    {compound.pending > 0 && ` â€¢ Complete all ${compound.totalDaysInJourney} days to reach ${compound.potentialX}X!`}
                                </p>
                            ) : (
                                <p style={{ color: 'var(--text-secondary)' }}>
                                    ðŸ“ Complete your first milestone to start your 1% daily compounding!
                                </p>
                            )}
                        </div>
                        
                        {/* Formula Explanation */}
                        <div style={{ marginTop: '12px', padding: '12px', background: 'var(--bg-secondary)', borderRadius: 'var(--radius-sm)', fontSize: '11px', color: 'var(--text-muted)' }}>
                            <strong>The 37X Formula:</strong> 1.01 raised to the power of days worked<br/>
                            â€¢ 100 days â†’ 1.01^100 = 2.70X<br/>
                            â€¢ 200 days â†’ 1.01^200 = 7.32X<br/>
                            â€¢ 365 days â†’ 1.01^365 = 37.78X ðŸ†
                        </div>
                    </div>
                </div>
            );
        };
        
        const Dashboard = ({ data, onUpdate, onReset }) => {
            const [activeTab, setActiveTab] = useState('milestones');
            const [selectedMilestone, setSelectedMilestone] = useState(null);
            const [showCelebration, setShowCelebration] = useState(false);
            const [celebrationType, setCelebrationType] = useState('major');
            
            // Safety check for data structure
            if (!data || !data.journey || !data.milestones) {
                return (
                    <div className="card" style={{ textAlign: 'center', padding: '40px' }}>
                        <h3>âš ï¸ Data Issue</h3>
                        <p style={{ marginTop: '12px', color: 'var(--text-secondary)' }}>
                            Journey data is missing or corrupted.
                        </p>
                        <button className="btn-primary" onClick={onReset} style={{ marginTop: '20px' }}>
                            ðŸ”„ Start Fresh
                        </button>
                    </div>
                );
            }
            
            const { userName, journey, milestones, kpis } = data;
            const cat = CATEGORIES[journey.category] || CATEGORIES.custom;
            
            // ========== MEANINGFUL COMPLETION STATUS ==========
            // Count retries that are completed - these "recover" from failures
            const retryMilestones = milestones.filter(m => m.isRetry === true);
            const completedRetries = retryMilestones.filter(m => m.status === 'completed').length;
            const failedMilestones = milestones.filter(m => m.status === 'not-reached' && !m.isRetry).length;
            
            // "Recovered" failures = failures that have a completed retry
            // For each completed retry, one failure is "recovered"
            const recoveredFailures = Math.min(failedMilestones, completedRetries);
            const unrecoveredFailures = failedMilestones - recoveredFailures;
            
            // ORIGINAL milestones only (excluding retries) for base count
            const originalMilestones = milestones.filter(m => !m.isRetry);
            const totalOriginal = originalMilestones.length;
            const originalMajor = originalMilestones.filter(m => m.type === 'major').length;
            
            // Effective completed = actual completed (including retries) 
            const completedAll = milestones.filter(m => m.status === 'completed').length;
            const pendingAll = milestones.filter(m => m.status === 'pending').length;
            
            // For MAJOR goals: count completed majors, plus recovered major failures
            const completedMajor = milestones.filter(m => m.type === 'major' && m.status === 'completed').length;
            const failedMajor = milestones.filter(m => m.type === 'major' && m.status === 'not-reached' && !m.isRetry).length;
            const recoveredMajor = retryMilestones.filter(m => m.type === 'major' && m.status === 'completed').length;
            
            // Effective major progress: completed majors from originals + retries covers the failures
            // If you had 5 majors, failed 1, but completed its retry, you effectively completed 5/5
            const totalMajor = originalMajor; // Use original count as base
            const effectiveMajorCompleted = Math.min(totalMajor, completedMajor); // Cap at original count
            
            // Progress percent based on effective completion
            const progressPercent = totalMajor > 0 ? Math.round((effectiveMajorCompleted / totalMajor) * 100) : 0;
            
            // ========== JOURNEY STATUS WITH NOTES ==========
            // Determine overall journey status
            const getJourneyStatus = () => {
                const allWorkDone = pendingAll === 0;
                const hadSetbacks = failedMilestones > 0;
                const fullyRecovered = recoveredFailures === failedMilestones;
                
                if (allWorkDone && !hadSetbacks) {
                    return {
                        status: 'Perfect',
                        emoji: 'ðŸ†',
                        color: 'var(--success)',
                        message: 'Perfect completion! No setbacks.',
                        note: 'You completed every milestone without missing any. Amazing discipline!'
                    };
                }
                if (allWorkDone && hadSetbacks && fullyRecovered) {
                    return {
                        status: 'Completed',
                        emoji: 'âœ…',
                        color: 'var(--success)',
                        message: 'Journey complete! Recovered from setbacks.',
                        note: `You had ${failedMilestones} setback${failedMilestones > 1 ? 's' : ''}, but you came back stronger and finished everything!`
                    };
                }
                if (allWorkDone && hadSetbacks && !fullyRecovered) {
                    return {
                        status: 'Finished',
                        emoji: 'ðŸ“‹',
                        color: 'var(--warning)',
                        message: 'Journey finished with gaps.',
                        note: `${unrecoveredFailures} milestone${unrecoveredFailures > 1 ? 's' : ''} missed and not recovered. Still made significant progress!`
                    };
                }
                if (!allWorkDone && hadSetbacks && fullyRecovered) {
                    return {
                        status: 'In Progress',
                        emoji: 'ðŸ”„',
                        color: 'var(--accent-sage)',
                        message: 'On track! Recovered from setbacks.',
                        note: `You recovered from ${failedMilestones} setback${failedMilestones > 1 ? 's' : ''}. Keep going!`
                    };
                }
                if (!allWorkDone && hadSetbacks) {
                    return {
                        status: 'Recovering',
                        emoji: 'ðŸ’ª',
                        color: 'var(--warning)',
                        message: 'Working through setbacks.',
                        note: `${unrecoveredFailures} pending recovery. Stay focused!`
                    };
                }
                return {
                    status: 'In Progress',
                    emoji: 'ðŸš€',
                    color: 'var(--accent-sage)',
                    message: 'Making steady progress!',
                    note: `${pendingAll} milestone${pendingAll > 1 ? 's' : ''} remaining. You got this!`
                };
            };
            
            const journeyStatus = getJourneyStatus();
            
            // MILESTONE-BASED compound calculation with DAYS-based streak
            const compound = calculateMilestoneCompound(milestones, journey.endDate, journey.startDate);
            const daysLeft = compound.daysToNextMilestone;
            
            const handleMilestoneSave = (updated) => {
                const newMilestones = milestones.map(m => m.id === updated.id ? updated : m);
                // Milestone-based tracking - no dailyProgress needed
                onUpdate({ ...data, milestones: newMilestones });
                
                // Trigger celebration for completed milestones
                if (updated.status === 'completed') {
                    const oldMilestone = milestones.find(m => m.id === updated.id);
                    // Only celebrate if status changed to completed
                    if (oldMilestone && oldMilestone.status !== 'completed') {
                        // Check if this completes ALL milestones
                        const newPending = newMilestones.filter(m => m.status === 'pending').length;
                        if (newPending === 0) {
                            setCelebrationType('complete');
                        } else if (updated.type === 'major') {
                            setCelebrationType('major');
                        } else {
                            setCelebrationType('minor');
                        }
                        setShowCelebration(true);
                    }
                }
            };
            
            // Handle timeline shift when user misses a milestone
            // shiftType: 'compress' = keep original end date, 'extend' = push end date
            // KEY: Create a RETRY milestone for the failed one, then redistribute remaining
            const handleShiftTimeline = (missedMilestone, newStartDate, actualValue, notes, shiftType = 'compress') => {
                const today = getToday();
                
                // 1. Mark the original milestone as not-reached (strikethrough)
                const updatedMissed = {
                    ...missedMilestone,
                    status: 'not-reached',
                    actualValue,
                    notes,
                    completedAt: today
                };
                
                // 2. Get pending milestones after the missed one (these will be redistributed)
                const pendingAfterMissed = milestones.filter(m => 
                    m.status === 'pending' && m.percent > missedMilestone.percent
                ).sort((a, b) => a.percent - b.percent);
                
                // 3. Create a RETRY milestone (copy of failed one with new dates)
                // This retry milestone + remaining pending milestones = total to redistribute
                const retryMilestone = {
                    ...missedMilestone,
                    id: `m_retry_${Date.now()}`, // New unique ID
                    status: 'pending',
                    actualValue: null,
                    notes: '',
                    completedAt: null,
                    isRetry: true, // Mark as retry
                    originalMilestoneId: missedMilestone.id
                };
                
                // Total milestones to redistribute: retry + remaining pending
                const milestonesToRedistribute = [retryMilestone, ...pendingAfterMissed];
                const totalToRedistribute = milestonesToRedistribute.length;
                
                let newEndDate = journey.endDate;
                let daysPerMilestone;
                
                if (shiftType === 'compress') {
                    // COMPRESS: Keep original end date, redistribute milestones
                    const remainingDays = daysBetween(newStartDate, journey.endDate);
                    
                    if (remainingDays <= 0) {
                        alert('âš ï¸ New start date must be before the target date (' + formatDate(journey.endDate) + ')');
                        return;
                    }
                    
                    daysPerMilestone = remainingDays / totalToRedistribute;
                    
                } else {
                    // EXTEND: Keep same duration per milestone, push end date
                    // Use the failed milestone's original duration as reference
                    const missedDuration = daysBetween(
                        missedMilestone.startDate || missedMilestone.targetDate,
                        missedMilestone.endDate || missedMilestone.targetDate
                    );
                    
                    daysPerMilestone = missedDuration || 30; // Default 30 days
                    newEndDate = addDays(newStartDate, Math.round(daysPerMilestone * totalToRedistribute));
                }
                
                // 4. Calculate new dates for retry milestone
                const retryWithDates = {
                    ...retryMilestone,
                    startDate: newStartDate,
                    endDate: addDays(newStartDate, Math.round(daysPerMilestone)),
                    targetDate: addDays(newStartDate, Math.round(daysPerMilestone))
                };
                
                // 5. Redistribute remaining pending milestones (after the retry)
                const updatedPending = pendingAfterMissed.map((m, idx) => {
                    // idx + 1 because retry milestone is at position 0
                    const position = idx + 1;
                    const newMilestoneStartDate = addDays(newStartDate, Math.round(position * daysPerMilestone));
                    const newMilestoneEndDate = addDays(newStartDate, Math.round((position + 1) * daysPerMilestone));
                    
                    return { 
                        ...m, 
                        startDate: newMilestoneStartDate,
                        endDate: newMilestoneEndDate,
                        targetDate: newMilestoneEndDate
                    };
                });
                
                // 6. Build final milestones array:
                // - Keep completed milestones as-is
                // - Replace missed milestone with updated (not-reached) version
                // - Insert retry milestone right after the failed one
                // - Update remaining pending milestones
                const finalMilestones = [];
                
                milestones.forEach(m => {
                    if (m.id === missedMilestone.id) {
                        // Add the failed milestone (strikethrough)
                        finalMilestones.push(updatedMissed);
                        // Add the retry milestone right after
                        finalMilestones.push(retryWithDates);
                    } else if (m.status === 'pending' && m.percent > missedMilestone.percent) {
                        // Find and add the updated pending milestone
                        const updated = updatedPending.find(up => up.id === m.id);
                        if (updated) finalMilestones.push(updated);
                    } else {
                        // Keep as-is (completed milestones)
                        finalMilestones.push(m);
                    }
                });
                
                // Update journey end date if extended
                const updatedJourney = shiftType === 'extend' 
                    ? { ...journey, endDate: newEndDate }
                    : journey;
                
                onUpdate({ 
                    ...data, 
                    journey: updatedJourney,
                    milestones: finalMilestones
                });
            };
            
            return (
                <div>
                    {/* Celebration Fireworks */}
                    <FireworkCelebration 
                        show={showCelebration} 
                        type={celebrationType}
                        onComplete={() => setShowCelebration(false)}
                    />
                    
                    <div className="card" style={{ textAlign: 'center' }}>
                        <p style={{ color: 'var(--text-muted)', marginBottom: '8px' }}>Welcome back,</p>
                        <h2 style={{ fontSize: '28px', marginBottom: '12px' }}>{userName} {cat.icon}</h2>
                        <p style={{ color: 'var(--text-secondary)', fontSize: '15px' }}>{journey.goal}</p>
                        <p style={{ color: 'var(--text-muted)', fontSize: '13px', marginTop: '8px' }}>{formatDateFull(journey.startDate)} â†’ {formatDateFull(journey.endDate)}</p>
                        
                        {/* Journey Status Banner */}
                        <div style={{ 
                            background: `linear-gradient(135deg, ${journeyStatus.color}15, ${journeyStatus.color}08)`,
                            border: `1px solid ${journeyStatus.color}40`,
                            borderRadius: 'var(--radius-md)',
                            padding: '16px',
                            marginBottom: '20px'
                        }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '8px' }}>
                                <span style={{ fontSize: '28px' }}>{journeyStatus.emoji}</span>
                                <div>
                                    <p style={{ fontWeight: '700', fontSize: '16px', color: journeyStatus.color, margin: 0 }}>
                                        {journeyStatus.status}: {journeyStatus.message}
                                    </p>
                                    <p style={{ fontSize: '13px', color: 'var(--text-secondary)', margin: '4px 0 0 0' }}>
                                        {journeyStatus.note}
                                    </p>
                                </div>
                            </div>
                            {/* Setback/Recovery Summary */}
                            {failedMilestones > 0 && (
                                <div style={{ 
                                    marginTop: '12px', 
                                    paddingTop: '12px', 
                                    borderTop: '1px solid rgba(0,0,0,0.06)',
                                    display: 'flex',
                                    gap: '16px',
                                    fontSize: '12px'
                                }}>
                                    <span style={{ color: 'var(--danger)' }}>
                                        âŒ {failedMilestones} setback{failedMilestones > 1 ? 's' : ''}
                                    </span>
                                    <span style={{ color: 'var(--success)' }}>
                                        âœ… {recoveredFailures} recovered
                                    </span>
                                    {unrecoveredFailures > 0 && (
                                        <span style={{ color: 'var(--warning)' }}>
                                            â³ {unrecoveredFailures} pending
                                        </span>
                                    )}
                                </div>
                            )}
                        </div>
                        
                        <div className="progress-container">
                            <div className="progress-header">
                                <span>ðŸ”¥ {compound.streakDays} day{compound.streakDays === 1 ? '' : 's'} streak</span>
                                <span style={{ fontWeight: '600' }}>
                                    {progressPercent}% {progressPercent === 100 ? 'ðŸŽ‰' : ''} Major Goals
                                </span>
                            </div>
                            <div className="progress-bar">
                                <div className="progress-fill" style={{ width: `${progressPercent}%` }}></div>
                            </div>
                        </div>
                        
                        <div className="stats-grid">
                            <div className="stat-card">
                                <div className="stat-value">{effectiveMajorCompleted}/{totalMajor}</div>
                                <div className="stat-label">Major â­</div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-value">{completedAll}</div>
                                <div className="stat-label">Completed</div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-value" style={{ color: daysLeft < 7 && daysLeft > 0 ? 'var(--danger)' : 'var(--accent-sage)' }}>
                                    {compound.pending > 0 ? Math.max(0, daysLeft) : 'âœ“'}
                                </div>
                                <div className="stat-label">{compound.pending > 0 ? 'Days to Next' : 'All Done!'}</div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-value" style={{ color: 'var(--accent-lavender)' }}>{compound.actualX}X</div>
                                <div className="stat-label">Growth</div>
                            </div>
                        </div>
                    </div>
                    
                    <div className="nav-tabs">
                        <button className={`nav-tab ${activeTab === 'milestones' ? 'active' : ''}`} onClick={() => setActiveTab('milestones')}>ðŸ“ Milestones ({milestones.length})</button>
                        <button className={`nav-tab ${activeTab === 'progress' ? 'active' : ''}`} onClick={() => setActiveTab('progress')}>ðŸ“ˆ Growth Tracker</button>
                    </div>
                    
                    {activeTab === 'milestones' && (
                        <div className="card">
                            <h3 style={{ marginBottom: '8px' }}>Your Milestones</h3>
                            <p style={{ color: 'var(--text-secondary)', marginBottom: '24px', fontSize: '14px' }}>
                                Complete milestones in order. Click the <strong>next pending</strong> milestone to update.
                            </p>
                            
                            <div className="timeline">
                                {(() => {
                                    // Find the index of the first pending milestone
                                    const nextPendingIndex = milestones.findIndex(m => m.status === 'pending');
                                    
                                    return milestones.map((m, idx) => {
                                        const isNextPending = idx === nextPendingIndex;
                                        const isLocked = m.status === 'pending' && idx > nextPendingIndex;
                                        const isClickable = isNextPending || m.status !== 'pending';
                                        
                                        return (
                                    <div 
                                        key={m.id} 
                                        className={`milestone-item ${m.type} ${m.status}`} 
                                        onClick={() => isClickable && setSelectedMilestone(m)}
                                        style={{
                                            cursor: isClickable ? 'pointer' : 'not-allowed',
                                            opacity: isLocked ? 0.5 : 1,
                                            border: isNextPending ? '2px solid var(--accent-sage)' : undefined,
                                            boxShadow: isNextPending ? '0 0 20px rgba(156,175,136,0.3)' : undefined
                                        }}
                                    >
                                        <div style={{ display: 'flex', gap: '8px', alignItems: 'center', flexWrap: 'wrap' }}>
                                            <span className={`milestone-type-badge ${m.type}`}>{m.type === 'major' ? 'â­ MAJOR' : 'ðŸ“‹ Minor'}</span>
                                            {m.isRetry && (
                                                <span style={{ 
                                                    display: 'inline-block', 
                                                    padding: '2px 8px', 
                                                    borderRadius: '12px',
                                                    fontSize: '10px', 
                                                    fontWeight: '700', 
                                                    background: 'rgba(201, 168, 108, 0.3)', 
                                                    color: 'var(--accent-gold)' 
                                                }}>
                                                    ðŸ”„ RETRY
                                                </span>
                                            )}
                                        </div>
                                        <div className="milestone-date">
                                            {formatDate(m.startDate || m.targetDate)} â†’ {formatDate(m.endDate || m.targetDate)}
                                            {m.targetDate < getToday() && m.status === 'pending' && <span style={{ color: 'var(--danger)', marginLeft: '8px' }}>âš ï¸ Overdue</span>}
                                        </div>
                                        <div className="milestone-title">{m.title}</div>
                                        <div className="milestone-kpi">ðŸŽ¯ Target: {m.kpiTarget} {m.kpiUnit}</div>
                                        {m.actualValue && <div style={{ fontSize: '13px', color: 'var(--text-secondary)' }}>âœ“ Actual: {m.actualValue} {m.kpiUnit}</div>}
                                        <span className={`milestone-status ${m.status}`}>
                                            {m.status === 'completed' ? 'âœ… Reached' : m.status === 'not-reached' ? 'âŒ Not Reached' : 'â³ Pending'}
                                        </span>
                                        
                                        {/* Tips & Quote */}
                                        {m.status === 'pending' && m.tips && (
                                            <div style={{ marginTop: '16px', padding: '12px', background: 'var(--bg-secondary)', borderRadius: 'var(--radius-sm)' }}>
                                                <div style={{ fontSize: '12px', fontWeight: '600', color: 'var(--accent-sage)', marginBottom: '8px' }}>ðŸ’¡ Tips to reach this milestone:</div>
                                                <ul style={{ fontSize: '13px', color: 'var(--text-secondary)', paddingLeft: '16px', margin: 0 }}>
                                                    {m.tips.map((tip, i) => <li key={i} style={{ marginBottom: '4px' }}>{tip}</li>)}
                                                </ul>
                                                {m.quote && (
                                                    <div style={{ marginTop: '12px', padding: '10px', background: 'rgba(255,255,255,0.7)', borderRadius: '8px', borderLeft: '3px solid var(--accent-lavender)' }}>
                                                        <p style={{ fontSize: '12px', color: 'var(--text-secondary)', fontStyle: 'italic', margin: 0 }}>{m.quote}</p>
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                        
                                        {m.notes && <p style={{ marginTop: '12px', fontSize: '13px', color: 'var(--text-muted)', fontStyle: 'italic' }}>"{m.notes}"</p>}
                                        
                                        {/* Locked indicator */}
                                        {isLocked && (
                                            <div style={{ marginTop: '12px', padding: '8px 12px', background: 'rgba(0,0,0,0.05)', borderRadius: '8px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                                <span>ðŸ”’</span>
                                                <span style={{ fontSize: '12px', color: 'var(--text-muted)' }}>Complete previous milestone first</span>
                                            </div>
                                        )}
                                        
                                        {/* Next milestone indicator */}
                                        {isNextPending && (
                                            <div style={{ marginTop: '12px', padding: '8px 12px', background: 'rgba(156,175,136,0.15)', borderRadius: '8px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                                <span>ðŸ‘†</span>
                                                <span style={{ fontSize: '12px', color: 'var(--accent-sage)', fontWeight: '600' }}>Click to update this milestone</span>
                                            </div>
                                        )}
                                    </div>
                                        );
                                    });
                                })()}
                            </div>
                        </div>
                    )}
                    
                    {activeTab === 'progress' && <MilestoneProgressTab milestones={milestones} compound={compound} journeyStatus={journeyStatus} recoveryStats={{ failedMilestones, recoveredFailures, unrecoveredFailures }} />}
                    
                    {selectedMilestone && <MilestoneModal milestone={selectedMilestone} onClose={() => setSelectedMilestone(null)} onSave={handleMilestoneSave} onShiftTimeline={handleShiftTimeline} />}
                </div>
            );
        };
        
        // Storage Indicator Component
        const StorageIndicator = ({ lastSaved }) => (
            <div className="storage-indicator saved">
                <span>ðŸ’¾</span>
                <span>Saved to localStorage</span>
                {lastSaved && <span style={{ opacity: 0.6 }}>â€¢ {lastSaved}</span>}
            </div>
        );
        
        // Help Modal Component
        const HelpModal = ({ onClose }) => {
            const steps = [
                { icon: 'ðŸŽ¯', title: 'Choose Your Journey', desc: 'Select a life area you want to transform (Health, Career, Finances, etc.)' },
                { icon: 'ðŸ“', title: 'Set Your Goal', desc: 'Define your specific goal, target date, and key metrics (KPIs) to track' },
                { icon: 'ðŸ”ï¸', title: 'Follow Milestones', desc: '12 milestones are auto-generated. Each milestone = growth multiplier!' },
                { icon: 'âœ…', title: 'Mark Progress', desc: 'Click each milestone when complete. Must be done in sequence!' },
                { icon: 'ðŸ“ˆ', title: 'Watch Growth', desc: 'See your compound growth (37.78X in a year of 1% daily)' },
                { icon: 'ðŸ’¾', title: 'Backup Data', desc: 'Export JSON to save, Import to restore on any device' }
            ];
            
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()} style={{ maxWidth: '500px' }}>
                        <div className="modal-header">
                            <h3>ðŸ“– How 37x Me Works</h3>
                            <button className="modal-close" onClick={onClose}>Ã—</button>
                        </div>
                        <div className="modal-body" style={{ padding: '24px' }}>
                            {/* The 37x Concept */}
                            <div style={{ 
                                background: 'linear-gradient(135deg, rgba(156, 175, 136, 0.15) 0%, rgba(184, 169, 201, 0.1) 100%)',
                                padding: '20px',
                                borderRadius: 'var(--radius-md)',
                                marginBottom: '24px',
                                textAlign: 'center'
                            }}>
                                <h4 style={{ fontSize: '18px', marginBottom: '12px' }}>ðŸŒ± The Power of 1%</h4>
                                <p style={{ fontSize: '24px', fontWeight: '700', color: 'var(--accent-sage)', marginBottom: '8px' }}>
                                    1.01<sup>365</sup> = 37.78X
                                </p>
                                <p style={{ color: 'var(--text-secondary)', fontSize: '14px' }}>
                                    Improve just 1% every day, and you'll be <strong>37.78 times better</strong> in a year!
                                </p>
                            </div>
                            
                            {/* Steps */}
                            <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
                                {steps.map((step, i) => (
                                    <div key={i} style={{ display: 'flex', gap: '16px', alignItems: 'flex-start' }}>
                                        <div style={{ 
                                            width: '40px', 
                                            height: '40px', 
                                            borderRadius: '50%', 
                                            background: 'var(--bg-secondary)', 
                                            display: 'flex', 
                                            alignItems: 'center', 
                                            justifyContent: 'center',
                                            fontSize: '20px',
                                            flexShrink: 0
                                        }}>
                                            {step.icon}
                                        </div>
                                        <div>
                                            <h5 style={{ fontSize: '14px', fontWeight: '600', marginBottom: '4px' }}>{step.title}</h5>
                                            <p style={{ fontSize: '13px', color: 'var(--text-secondary)' }}>{step.desc}</p>
                                        </div>
                                    </div>
                                ))}
                            </div>
                            
                            {/* Storage Info */}
                            <div style={{ 
                                background: 'var(--bg-secondary)', 
                                padding: '16px', 
                                borderRadius: 'var(--radius-sm)', 
                                marginTop: '24px',
                                fontSize: '13px'
                            }}>
                                <h5 style={{ marginBottom: '8px' }}>ðŸ’¾ Where is my data stored?</h5>
                                <p style={{ color: 'var(--text-secondary)', marginBottom: '8px' }}>
                                    Your data is stored in your browser's <strong>localStorage</strong> as JSON.
                                </p>
                                <p style={{ color: 'var(--text-muted)', fontSize: '12px' }}>
                                    ðŸ“ Location: <code style={{ background: 'white', padding: '2px 6px', borderRadius: '4px' }}>localStorage["37x_journey_*"]</code>
                                </p>
                                <p style={{ color: 'var(--text-muted)', fontSize: '12px', marginTop: '8px' }}>
                                    âš ï¸ Data stays on THIS browser only. Use Export/Import for backups!
                                </p>
                            </div>
                            
                            {/* Security Scanner */}
                            <div style={{ 
                                background: 'linear-gradient(135deg, rgba(156, 175, 136, 0.1) 0%, rgba(168, 196, 196, 0.1) 100%)',
                                padding: '16px', 
                                borderRadius: 'var(--radius-sm)', 
                                marginTop: '16px',
                                fontSize: '13px',
                                border: '1px solid rgba(156, 175, 136, 0.2)'
                            }}>
                                <h5 style={{ marginBottom: '12px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                    ðŸ”’ Security & Privacy
                                </h5>
                                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                        <span style={{ color: 'var(--success)' }}>âœ…</span>
                                        <span style={{ color: 'var(--text-secondary)' }}>100% Client-side - No data sent to servers</span>
                                    </div>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                        <span style={{ color: 'var(--success)' }}>âœ…</span>
                                        <span style={{ color: 'var(--text-secondary)' }}>No cookies or tracking</span>
                                    </div>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                        <span style={{ color: 'var(--success)' }}>âœ…</span>
                                        <span style={{ color: 'var(--text-secondary)' }}>No external API calls</span>
                                    </div>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                        <span style={{ color: 'var(--success)' }}>âœ…</span>
                                        <span style={{ color: 'var(--text-secondary)' }}>Works 100% offline</span>
                                    </div>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                        <span style={{ color: 'var(--success)' }}>âœ…</span>
                                        <span style={{ color: 'var(--text-secondary)' }}>Open source - inspect the code yourself!</span>
                                    </div>
                                </div>
                                <p style={{ color: 'var(--text-muted)', fontSize: '11px', marginTop: '12px', fontStyle: 'italic' }}>
                                    ðŸ›¡ï¸ Your personal growth data never leaves your device.
                                </p>
                            </div>
                            
                            {/* Export/Import Info */}
                            <div style={{ 
                                background: 'rgba(201, 168, 108, 0.1)',
                                padding: '16px', 
                                borderRadius: 'var(--radius-sm)', 
                                marginTop: '16px',
                                fontSize: '13px',
                                border: '1px solid rgba(201, 168, 108, 0.2)'
                            }}>
                                <h5 style={{ marginBottom: '8px' }}>ðŸ“¦ Export & Import Journeys</h5>
                                <p style={{ color: 'var(--text-secondary)', marginBottom: '8px' }}>
                                    Each journey can be exported individually as a JSON file.
                                </p>
                                <ul style={{ color: 'var(--text-muted)', fontSize: '12px', paddingLeft: '16px', margin: 0 }}>
                                    <li style={{ marginBottom: '4px' }}>ðŸ“¤ <strong>Export</strong>: Download current journey as JSON file</li>
                                    <li style={{ marginBottom: '4px' }}>ðŸ“¥ <strong>Import</strong>: Load a JSON file as a NEW journey</li>
                                    <li>ðŸ’¡ Great for backups, sharing, or transferring between devices!</li>
                                </ul>
                            </div>
                        </div>
                        <div className="modal-footer">
                            <button className="btn-primary" onClick={onClose}>Got it! ðŸš€</button>
                        </div>
                    </div>
                </div>
            );
        };
        
        // Backup Actions Component (Export/Import)
        const BackupActions = ({ data, onImport }) => {
            // Get journey info for file naming
            const journeyName = data?.journey?.goal 
                ? data.journey.goal.substring(0, 30).replace(/[^a-zA-Z0-9]/g, '_')
                : 'journey';
            const categoryName = data?.journey?.category || 'general';
            const catIcon = CATEGORIES[categoryName]?.icon || 'ðŸ“‹';
            
            const handleExport = () => {
                const jsonStr = JSON.stringify(data, null, 2);
                const blob = new Blob([jsonStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                // Name file with category and journey goal
                const fileName = `37x_${categoryName.toUpperCase()}_${journeyName}_${new Date().toISOString().split('T')[0]}.json`;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert(`âœ… Exported: ${fileName}\n\nThis file contains only this journey's data.`);
            };
            
            const handleImport = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                try {
                    const text = await file.text();
                    const parsed = JSON.parse(text);
                    
                    // Validate basic structure
                    if (!parsed.version) {
                        alert('Invalid backup file. Missing version info.');
                        return;
                    }
                    
                    const importGoal = parsed.journey?.goal || 'Unknown Journey';
                    const importCat = CATEGORIES[parsed.journey?.category]?.icon || 'ðŸ“‹';
                    
                    if (confirm(
                        `ðŸ“¥ IMPORT NEW JOURNEY\n\n` +
                        `File: "${file.name}"\n` +
                        `Journey: ${importCat} ${importGoal}\n\n` +
                        `This will ADD as a new journey.\n` +
                        `Your current journeys are NOT affected.\n\n` +
                        `Continue?`
                    )) {
                        onImport(parsed);
                        alert(`âœ… Imported: "${importGoal}"\n\nNew journey added to your list!`);
                    }
                } catch (err) {
                    alert('Error reading file: ' + err.message);
                }
                
                // Reset file input
                e.target.value = '';
            };
            
            const currentGoal = data?.journey?.goal 
                ? (data.journey.goal.length > 20 ? data.journey.goal.substring(0, 20) + '...' : data.journey.goal)
                : 'Current Journey';
            
            return (
                <div style={{ 
                    background: 'var(--bg-secondary)',
                    borderRadius: 'var(--radius-md)',
                    padding: '16px',
                    marginBottom: '16px'
                }}>
                    {/* Header showing which journey */}
                    <div style={{ 
                        textAlign: 'center', 
                        marginBottom: '12px',
                        paddingBottom: '12px',
                        borderBottom: '1px solid rgba(0,0,0,0.06)'
                    }}>
                        <span style={{ fontSize: '12px', color: 'var(--text-muted)', fontWeight: '600' }}>
                            ðŸ’¾ BACKUP FOR: {catIcon} {currentGoal}
                        </span>
                    </div>
                    
                    <div style={{ 
                        display: 'flex', 
                        gap: '12px', 
                        justifyContent: 'center',
                        flexWrap: 'wrap'
                    }}>
                        <button 
                            className="btn-secondary" 
                            onClick={handleExport} 
                            style={{ display: 'flex', alignItems: 'center', gap: '8px' }}
                            title={`Export "${data?.journey?.goal || 'journey'}" to JSON file`}
                        >
                            ðŸ“¤ Export This Journey
                        </button>
                        <label 
                            className="btn-secondary" 
                            style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer' }}
                            title="Import a journey from JSON file (adds as new)"
                        >
                            ðŸ“¥ Import New Journey
                            <input type="file" accept=".json" onChange={handleImport} style={{ display: 'none' }} />
                        </label>
                    </div>
                    
                    <p style={{ 
                        textAlign: 'center', 
                        fontSize: '11px', 
                        color: 'var(--text-muted)', 
                        marginTop: '10px',
                        marginBottom: 0 
                    }}>
                        Export saves this journey only â€¢ Import adds as a new journey
                    </p>
                </div>
            );
        };
        
        // Social Share & Footer Component
        const AppFooter = ({ userName, goal, milestones = [], category }) => {
            // Calculate progress for contextual share text
            const completed = milestones.filter(m => m.status === 'completed').length;
            const total = milestones.length;
            const progressPercent = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            // Different share texts based on progress
            const getShareText = (type) => {
                const hashtags = '#37xMe #PersonalGrowth #1PercentDaily';
                
                if (type === 'journey_start') {
                    return `ðŸŒ± Starting my 37x transformation journey!\n\nGoal: ${goal || 'Become 37.78x better'}\n\n1% daily improvement = 37.78x growth in a year. Who's with me?\n\n${hashtags}`;
                }
                
                if (type === 'milestone') {
                    return `ðŸŽ¯ Milestone ${completed}/${total} reached!\n\n${progressPercent}% closer to my goal: "${goal}"\n\nThe power of 1% daily: 1.01^365 = 37.78x growth!\n\n${hashtags}`;
                }
                
                if (type === 'progress') {
                    const growthX = Math.pow(1.35, completed).toFixed(2);
                    return `ðŸ“ˆ My 37x Progress Update:\n\nâœ… ${completed} milestones completed\nðŸŽ¯ ${progressPercent}% toward "${goal}"\nðŸ“Š ${growthX}X compound growth achieved!\n\nSmall daily improvements = massive results.\n\n${hashtags}`;
                }
                
                if (type === 'linkedin') {
                    return `I'm using a fascinating approach to personal growth called the "37x Method".\n\nThe math is simple but powerful: 1% improvement daily compounds to 37.78x growth in a year (1.01^365 = 37.78).\n\nCurrently tracking my journey toward: "${goal || 'personal transformation'}"\n\nðŸ“Š Progress: ${completed}/${total} milestones (${progressPercent}%)\n\nIt's a reminder that consistency beats intensity. What small improvements are you making today?\n\n${hashtags}`;
                }
                
                // Default
                return userName && goal 
                    ? `I'm on my 37x journey to "${goal}"! Growing 1% every day. Join me!\n\n${hashtags}`
                    : `Discover the power of 1% daily growth! 1.01^365 = 37.78x improvement in a year.\n\n${hashtags}`;
            };
            
            const shareUrl = 'https://37xme.app';
            
            const handleShare = async (platform, textType = 'default') => {
                const shareText = getShareText(textType);
                const encodedText = encodeURIComponent(shareText);
                const encodedUrl = encodeURIComponent(shareUrl);
                
                const urls = {
                    twitter: `https://twitter.com/intent/tweet?text=${encodedText}`,
                    facebook: `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}&quote=${encodedText}`,
                    whatsapp: `https://wa.me/?text=${encodeURIComponent(shareText + '\n\n' + shareUrl)}`,
                    linkedin: `https://www.linkedin.com/sharing/share-offsite/?url=${encodedUrl}`,
                    instagram: null
                };
                
                if (platform === 'instagram') {
                    try {
                        await navigator.clipboard.writeText(shareText + '\n\n' + shareUrl);
                        alert('ðŸ“‹ Copied to clipboard!\n\nNow open Instagram and paste in your story or post.');
                    } catch (e) {
                        prompt('Copy this text for Instagram:', shareText);
                    }
                    return;
                }
                
                if (platform === 'native' && navigator.share) {
                    try {
                        await navigator.share({ title: '37x Me - Personal Growth Journey', text: shareText, url: shareUrl });
                    } catch (e) { /* cancelled */ }
                    return;
                }
                
                if (urls[platform]) {
                    window.open(urls[platform], '_blank', 'width=600,height=500');
                }
            };
            
            return (
                <footer className="app-footer">
                    {/* Connect with Creator */}
                    <div className="connect-section">
                        <h3 style={{ fontSize: '18px', marginBottom: '12px', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '10px' }}>
                            <span>ðŸ‘‹</span> Let's Connect!
                        </h3>
                        <p style={{ color: 'var(--text-secondary)', fontSize: '14px', lineHeight: '1.7', marginBottom: '20px', maxWidth: '400px', margin: '0 auto 20px' }}>
                            Hi! I'm Lakshmi Venkatesh, the creator of 37x Me. I'd love to hear about your growth journey!
                        </p>
                        <a 
                            href="https://www.linkedin.com/in/lakshmivenkatesh/" 
                            target="_blank" 
                            rel="noopener noreferrer"
                            className="linkedin-btn"
                        >
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                            </svg>
                            Connect on LinkedIn
                        </a>
                    </div>
                    
                    {/* Share on Social Media */}
                    <div className="share-section">
                        <h4 style={{ fontSize: '15px', marginBottom: '8px' }}>ðŸŒŸ Share Your Journey</h4>
                        <p style={{ color: 'var(--text-secondary)', fontSize: '13px', lineHeight: '1.6', marginBottom: '8px' }}>
                            Inspire others with <strong>#37xMe</strong>
                        </p>
                        {completed > 0 && (
                            <p style={{ fontSize: '12px', color: 'var(--accent-sage)', marginBottom: '16px' }}>
                                âœ¨ Share your {completed} milestone{completed > 1 ? 's' : ''} achievement!
                            </p>
                        )}
                        
                        <div className="share-buttons">
                            {navigator.share && (
                                <button className="social-btn" onClick={() => handleShare('native', completed > 0 ? 'progress' : 'journey_start')} style={{ background: 'var(--accent-sage)', color: 'white' }}>
                                    ðŸ“¤ Share
                                </button>
                            )}
                            
                            {/* LinkedIn - Professional share */}
                            <button className="social-btn" onClick={() => handleShare('linkedin', 'linkedin')} style={{ background: '#0077b5', color: 'white' }}>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                                </svg>
                                LinkedIn
                            </button>
                            
                            <button className="social-btn twitter" onClick={() => handleShare('twitter', completed > 0 ? 'milestone' : 'journey_start')}>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                                Twitter/X
                            </button>
                            
                            <button className="social-btn instagram" onClick={() => handleShare('instagram', completed > 0 ? 'progress' : 'journey_start')}>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                                Instagram
                            </button>
                            
                            <button className="social-btn facebook" onClick={() => handleShare('facebook', 'progress')}>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                                Facebook
                            </button>
                            
                            <button className="social-btn whatsapp" onClick={() => handleShare('whatsapp', completed > 0 ? 'progress' : 'journey_start')}>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                                WhatsApp
                            </button>
                        </div>
                    </div>
                    
                    {/* Inspirational Quote */}
                    <div style={{ 
                        padding: '16px',
                        background: 'linear-gradient(135deg, rgba(184, 169, 201, 0.15) 0%, rgba(156, 175, 136, 0.1) 100%)',
                        borderRadius: 'var(--radius-md)',
                        textAlign: 'center',
                        marginBottom: '20px'
                    }}>
                        <p style={{ fontSize: '24px', marginBottom: '8px' }}>ðŸŒ¸</p>
                        <p style={{ color: 'var(--text-secondary)', fontSize: '14px', fontStyle: 'italic' }}>
                            "The journey of a thousand miles begins with a single step."<br/>
                            <span style={{ fontSize: '12px', color: 'var(--text-muted)' }}>â€” Lao Tzu</span>
                        </p>
                    </div>
                    
                    {/* Copyright */}
                    <div style={{ textAlign: 'center' }}>
                        <p style={{ color: 'var(--text-muted)', fontSize: '12px' }}>ðŸŒ¸ 37x Me â€” Your Personal Renewal Journal</p>
                        <p style={{ color: 'var(--text-muted)', fontSize: '11px', marginTop: '4px', opacity: 0.8 }}>
                            Bloom a little every day â€¢ Works offline â€¢ All data stored locally ðŸ’¾
                        </p>
                        <p style={{ color: 'var(--text-muted)', fontSize: '10px', marginTop: '8px', opacity: 0.6 }}>
                            Â© 2026 Lakshmi Venkatesh. All Rights Reserved.
                        </p>
                    </div>
                </footer>
            );
        };
        
        // ==================== APP ====================
        // ==================== MULTI-JOURNEY STORAGE HELPERS ====================
        const JOURNEYS_LIST_KEY = '37x_journeys_list';
        const JOURNEY_PREFIX = '37x_journey_';
        const CURRENT_JOURNEY_KEY = '37x_current_journey';
        
        // Get all journey IDs
        const getJourneysList = () => {
            try {
                const list = localStorage.getItem(JOURNEYS_LIST_KEY);
                return list ? JSON.parse(list) : [];
            } catch (e) {
                return [];
            }
        };
        
        // Save journeys list
        const saveJourneysList = (list) => {
            localStorage.setItem(JOURNEYS_LIST_KEY, JSON.stringify(list));
        };
        
        // Get journey data by ID
        const getJourneyData = (journeyId) => {
            try {
                const data = localStorage.getItem(JOURNEY_PREFIX + journeyId);
                return data ? JSON.parse(data) : null;
            } catch (e) {
                return null;
            }
        };
        
        // Save journey data
        const saveJourneyData = (journeyId, data) => {
            localStorage.setItem(JOURNEY_PREFIX + journeyId, JSON.stringify(data));
        };
        
        // Delete journey
        const deleteJourneyData = (journeyId) => {
            localStorage.removeItem(JOURNEY_PREFIX + journeyId);
            const list = getJourneysList().filter(id => id !== journeyId);
            saveJourneysList(list);
        };
        
        // Generate journey ID from category and goal
        const generateJourneyId = (category, goal) => {
            const base = goal ? goal.substring(0, 20).replace(/[^a-zA-Z0-9]/g, '_') : category;
            const timestamp = Date.now().toString(36);
            return `${category}_${base}_${timestamp}`.toUpperCase();
        };
        
        // Get journey display name
        const getJourneyDisplayName = (data) => {
            if (!data || !data.journey) return 'New Journey';
            const cat = CATEGORIES[data.journey.category];
            const goalShort = data.journey.goal ? data.journey.goal.substring(0, 25) : '';
            return `${cat?.icon || 'ðŸ“‹'} ${goalShort}${data.journey.goal?.length > 25 ? '...' : ''}`;
        };
        
        // ==================== JOURNEY SELECTOR COMPONENT ====================
        const JourneySelector = ({ journeysList, currentJourneyId, onSelect, onCreate, onDelete, data, isCreatingNew }) => {
            const [showDropdown, setShowDropdown] = useState(false);
            
            // Close dropdown when clicking outside
            useEffect(() => {
                const handleClickOutside = () => setShowDropdown(false);
                if (showDropdown) {
                    document.addEventListener('click', handleClickOutside);
                    return () => document.removeEventListener('click', handleClickOutside);
                }
            }, [showDropdown]);
            
            // Get journey info for each ID
            const journeysInfo = journeysList.map(id => {
                const jData = id === currentJourneyId ? data : getJourneyData(id);
                return {
                    id,
                    name: getJourneyDisplayName(jData),
                    category: jData?.journey?.category,
                    goal: jData?.journey?.goal,
                    isCurrent: id === currentJourneyId
                };
            });
            
            const currentJourney = journeysInfo.find(j => j.isCurrent);
            
            const handleDelete = (journeyId) => {
                const journey = journeysInfo.find(j => j.id === journeyId);
                if (window.confirm(`Delete "${journey?.goal || journey?.name}"?\n\nThis will permanently remove this journey and all its data.`)) {
                    onDelete(journeyId);
                    setShowDropdown(false);
                }
            };
            
            const handleCreate = (e) => {
                e.stopPropagation();
                setShowDropdown(false);
                onCreate();
            };
            
            return (
                <div style={{ 
                    background: 'var(--bg-card)',
                    borderRadius: 'var(--radius-md)',
                    padding: '12px 16px',
                    marginBottom: '20px',
                    border: '1px solid rgba(0,0,0,0.06)',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '12px',
                    flexWrap: 'wrap',
                    position: 'relative'
                }}>
                    <span style={{ fontSize: '12px', color: 'var(--text-muted)', fontWeight: '600' }}>
                        ðŸ“ TRACKING:
                    </span>
                    
                    {/* Current Journey Dropdown */}
                    <div style={{ position: 'relative', flex: 1, minWidth: '200px' }}>
                        <button
                            onClick={(e) => { e.stopPropagation(); setShowDropdown(!showDropdown); }}
                            style={{
                                width: '100%',
                                background: 'rgba(156, 175, 136, 0.1)',
                                border: '1px solid var(--accent-sage)',
                                borderRadius: 'var(--radius-sm)',
                                padding: '10px 14px',
                                color: 'var(--text-primary)',
                                fontSize: '14px',
                                fontWeight: '600',
                                cursor: 'pointer',
                                textAlign: 'left',
                                display: 'flex',
                                justifyContent: 'space-between',
                                alignItems: 'center'
                            }}
                        >
                            <span>{isCreatingNew ? 'âœ¨ Creating new journey...' : (currentJourney?.name || 'Select Journey')}</span>
                            <span style={{ fontSize: '10px' }}>{showDropdown ? 'â–²' : 'â–¼'}</span>
                        </button>
                        
                        {/* Dropdown Menu */}
                        {showDropdown && (
                            <div style={{
                                position: 'absolute',
                                top: '100%',
                                left: 0,
                                right: 0,
                                background: 'white',
                                border: '1px solid rgba(0,0,0,0.1)',
                                borderRadius: 'var(--radius-sm)',
                                boxShadow: '0 8px 24px rgba(0,0,0,0.15)',
                                zIndex: 1000,
                                marginTop: '4px',
                                maxHeight: '300px',
                                overflowY: 'auto'
                            }}>
                                {/* Header */}
                                <div style={{ 
                                    padding: '10px 14px', 
                                    background: 'var(--bg-secondary)', 
                                    fontSize: '11px', 
                                    fontWeight: '600', 
                                    color: 'var(--text-muted)',
                                    borderBottom: '1px solid rgba(0,0,0,0.08)'
                                }}>
                                    ðŸ“‹ YOUR JOURNEYS (Click to switch)
                                </div>
                                
                                {journeysInfo.map(journey => (
                                    <div
                                        key={journey.id}
                                        onClick={(e) => { e.stopPropagation(); onSelect(journey.id); setShowDropdown(false); }}
                                        style={{
                                            padding: '12px 14px',
                                            borderBottom: '1px solid rgba(0,0,0,0.05)',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'space-between',
                                            background: journey.isCurrent ? 'rgba(156, 175, 136, 0.15)' : 'white',
                                            cursor: 'pointer',
                                            transition: 'background 0.2s ease'
                                        }}
                                        onMouseEnter={(e) => { if (!journey.isCurrent) e.currentTarget.style.background = 'rgba(156, 175, 136, 0.08)'; }}
                                        onMouseLeave={(e) => { if (!journey.isCurrent) e.currentTarget.style.background = 'white'; }}
                                    >
                                        <div style={{ flex: 1 }}>
                                            <div style={{ fontSize: '14px', fontWeight: journey.isCurrent ? '600' : '400' }}>
                                                {journey.name}
                                            </div>
                                            {journey.isCurrent && (
                                                <span style={{ fontSize: '10px', color: 'var(--accent-sage)', fontWeight: '600' }}>
                                                    âœ“ Currently Active
                                                </span>
                                            )}
                                            {!journey.isCurrent && (
                                                <span style={{ fontSize: '10px', color: 'var(--text-muted)' }}>
                                                    Click to switch â†’
                                                </span>
                                            )}
                                        </div>
                                        {journeysInfo.length > 1 && (
                                            <button
                                                onClick={(e) => { e.stopPropagation(); handleDelete(journey.id); }}
                                                style={{
                                                    background: 'none',
                                                    border: 'none',
                                                    color: 'var(--danger)',
                                                    cursor: 'pointer',
                                                    padding: '4px 8px',
                                                    fontSize: '12px',
                                                    opacity: 0.6
                                                }}
                                                title="Delete this journey"
                                            >
                                                ðŸ—‘ï¸
                                            </button>
                                        )}
                                    </div>
                                ))}
                                
                                {journeysInfo.length === 0 && (
                                    <div style={{ padding: '16px', textAlign: 'center', color: 'var(--text-muted)' }}>
                                        No journeys yet
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                    
                    {/* New Journey Button */}
                    <button
                        onClick={handleCreate}
                        disabled={isCreatingNew}
                        style={{
                            background: isCreatingNew ? 'var(--bg-secondary)' : 'linear-gradient(135deg, var(--accent-sage), #88a07a)',
                            border: isCreatingNew ? '1px solid var(--accent-sage)' : 'none',
                            borderRadius: 'var(--radius-sm)',
                            padding: '10px 16px',
                            color: isCreatingNew ? 'var(--accent-sage)' : 'white',
                            fontSize: '13px',
                            fontWeight: '600',
                            cursor: isCreatingNew ? 'default' : 'pointer',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '6px',
                            whiteSpace: 'nowrap',
                            opacity: isCreatingNew ? 0.7 : 1
                        }}
                    >
                        {isCreatingNew ? 'âœ¨ Creating...' : 'âž• New Journey'}
                    </button>
                    
                    {/* Journey Count Badge */}
                    <div style={{
                        background: 'var(--bg-secondary)',
                        padding: '6px 12px',
                        borderRadius: '20px',
                        fontSize: '11px',
                        color: 'var(--text-muted)',
                        fontWeight: '600'
                    }}>
                        {journeysList.length} active
                    </div>
                </div>
            );
        };
        
        // ==================== MAIN APP COMPONENT ====================
        const App = () => {
            const [data, setData] = useState(null);
            const [step, setStep] = useState('loading');
            const [selectedCategory, setSelectedCategory] = useState(null);
            const [showHelp, setShowHelp] = useState(false);
            const [lastSaved, setLastSaved] = useState('');
            
            // Multi-journey state
            const [journeysList, setJourneysList] = useState([]);
            const [currentJourneyId, setCurrentJourneyId] = useState(null);
            const [isCreatingNew, setIsCreatingNew] = useState(false);
            
            // Load journeys list and current journey on mount
            useEffect(() => {
                try {
                    const list = getJourneysList();
                    const savedCurrentId = localStorage.getItem(CURRENT_JOURNEY_KEY);
                    
                    if (list.length > 0) {
                        setJourneysList(list);
                        
                        // Load current journey or first available
                        const journeyIdToLoad = savedCurrentId && list.includes(savedCurrentId) 
                            ? savedCurrentId 
                            : list[0];
                        
                        const journeyData = getJourneyData(journeyIdToLoad);
                        if (journeyData && journeyData.version) {
                            setCurrentJourneyId(journeyIdToLoad);
                            setData(journeyData);
                            setStep(journeyData.journey ? 'dashboard' : 'category');
                        } else {
                            // Journey data corrupted, start fresh
                            console.warn('Journey data corrupted, starting fresh');
                            setData(createEmptyData());
                            setStep('category');
                            setIsCreatingNew(true);
                        }
                    } else {
                        // No journeys exist, start fresh
                        setData(createEmptyData());
                        setStep('category');
                        setShowHelp(true);
                        setIsCreatingNew(true);
                    }
                } catch (error) {
                    console.error('Error loading journeys:', error);
                    // Clear corrupted data and start fresh
                    setData(createEmptyData());
                    setStep('category');
                    setIsCreatingNew(true);
                }
            }, []);
            
            // Save current journey data when it changes
            useEffect(() => {
                if (data && currentJourneyId) {
                    saveJourneyData(currentJourneyId, data);
                    localStorage.setItem(CURRENT_JOURNEY_KEY, currentJourneyId);
                    setLastSaved(new Date().toLocaleTimeString());
                }
            }, [data, currentJourneyId]);
            
            // Switch to a different journey
            const handleSwitchJourney = (journeyId) => {
                if (journeyId === currentJourneyId) return;
                
                // Save current journey first
                if (data && currentJourneyId) {
                    saveJourneyData(currentJourneyId, data);
                }
                
                // Load new journey
                const journeyData = getJourneyData(journeyId);
                if (journeyData) {
                    setCurrentJourneyId(journeyId);
                    setData(journeyData);
                    setStep(journeyData.journey ? 'dashboard' : 'category');
                    localStorage.setItem(CURRENT_JOURNEY_KEY, journeyId);
                    setIsCreatingNew(false);
                }
            };
            
            // Create a new journey
            const handleCreateNewJourney = () => {
                // Save current journey first
                if (data && currentJourneyId) {
                    saveJourneyData(currentJourneyId, data);
                }
                
                // Start fresh for new journey
                setData(createEmptyData());
                setStep('category');
                setSelectedCategory(null);
                setCurrentJourneyId(null);
                setIsCreatingNew(true);
            };
            
            // Delete a journey
            const handleDeleteJourney = (journeyId) => {
                deleteJourneyData(journeyId);
                const newList = journeysList.filter(id => id !== journeyId);
                setJourneysList(newList);
                
                // If deleted current journey, switch to another or create new
                if (journeyId === currentJourneyId) {
                    if (newList.length > 0) {
                        handleSwitchJourney(newList[0]);
                    } else {
                        setData(createEmptyData());
                        setStep('category');
                        setCurrentJourneyId(null);
                        setIsCreatingNew(true);
                    }
                }
            };
            
            // Handle import from backup file
            const handleImport = (importedData) => {
                // Create a new journey for imported data
                const newId = generateJourneyId(
                    importedData.journey?.category || 'imported',
                    importedData.journey?.goal || 'Imported Journey'
                );
                
                const newList = [...journeysList, newId];
                setJourneysList(newList);
                saveJourneysList(newList);
                
                setCurrentJourneyId(newId);
                setData(importedData);
                setStep(importedData.journey ? 'dashboard' : 'category');
                setIsCreatingNew(false);
                
                saveJourneyData(newId, importedData);
            };
            
            const handleGoalSubmit = ({ name, journey, kpis }) => {
                const milestones = generateMilestones(journey.category, journey.goal, journey.startDate, journey.endDate, kpis);
                const newData = { ...data, userName: name, journey, kpis, milestones };
                
                // Generate journey ID if creating new
                let journeyId = currentJourneyId;
                if (isCreatingNew || !journeyId) {
                    journeyId = generateJourneyId(journey.category, journey.goal);
                    const newList = [...journeysList, journeyId];
                    setJourneysList(newList);
                    saveJourneysList(newList);
                    setCurrentJourneyId(journeyId);
                    setIsCreatingNew(false);
                }
                
                setData(newData);
                setStep('dashboard');
                saveJourneyData(journeyId, newData);
            };
            
            const handleReset = () => {
                const currentName = data?.journey?.goal || 'this journey';
                const otherJourneyCount = journeysList.length > 1 ? journeysList.length - 1 : 0;
                const userInput = prompt(
                    `âš ï¸ DELETE CURRENT JOURNEY ONLY\n\n` +
                    `ðŸ“ Journey: "${currentName}"\n\n` +
                    'â€¢ All milestones for THIS journey will be erased\n' +
                    'â€¢ All data for THIS journey will be lost\n' +
                    (otherJourneyCount > 0 ? `â€¢ Your ${otherJourneyCount} other journey(s) are SAFE âœ“\n` : '') +
                    'â€¢ This action CANNOT be undone\n\n' +
                    'ðŸ’¡ Tip: Export a backup first!\n\n' +
                    'To confirm, type DELETE below:'
                );
                
                if (userInput === 'DELETE') {
                    if (currentJourneyId) {
                        deleteJourneyData(currentJourneyId);
                        const newList = journeysList.filter(id => id !== currentJourneyId);
                        setJourneysList(newList);
                        
                        if (newList.length > 0) {
                            // Switch to another journey
                            handleSwitchJourney(newList[0]);
                            alert('âœ… Journey deleted. Switched to another journey.');
                        } else {
                            // No journeys left, create new
                            setData(createEmptyData());
                            setStep('category');
                            setSelectedCategory(null);
                            setCurrentJourneyId(null);
                            setIsCreatingNew(true);
                            alert('âœ… Journey deleted. Start a new one!');
                        }
                    } else {
                        setData(createEmptyData());
                        setStep('category');
                        setSelectedCategory(null);
                        alert('âœ… All data has been reset. Start fresh!');
                    }
                } else if (userInput !== null) {
                    alert('âŒ Reset cancelled. You must type "DELETE" exactly to confirm.');
                }
            };
            
            if (step === 'loading') return <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', minHeight: '100vh' }}><div style={{ textAlign: 'center' }}><div style={{ fontSize: '48px' }}>ðŸŒ±</div><p>Loading...</p></div></div>;
            
            return (
                <>
                    <WatercolorBackground />
                    
                    {/* Storage Indicator */}
                    {data && currentJourneyId && <StorageIndicator lastSaved={lastSaved} />}
                    
                    {/* Help Button */}
                    <button className="help-btn" onClick={() => setShowHelp(true)} title="Help & Guide">?</button>
                    
                    {/* Help Modal */}
                    {showHelp && <HelpModal onClose={() => setShowHelp(false)} />}
                    
                    <div className="content-wrapper">
                        <div className="container">
                            <div className="app-header">
                                <h1>37x Me</h1>
                                <p className="subtitle">Grow 1% daily â€¢ Become 37x better in a year</p>
                            </div>
                            
                            {/* Journey Selector - Always visible when there are journeys or on dashboard */}
                            {(journeysList.length > 0 || step === 'dashboard') && (
                                <JourneySelector
                                    journeysList={journeysList}
                                    currentJourneyId={currentJourneyId}
                                    onSelect={handleSwitchJourney}
                                    onCreate={handleCreateNewJourney}
                                    onDelete={handleDeleteJourney}
                                    data={data}
                                    isCreatingNew={isCreatingNew}
                                />
                            )}
                            
                            {/* Creating new journey indicator with back option */}
                            {isCreatingNew && step !== 'dashboard' && (
                                <div style={{
                                    background: 'linear-gradient(135deg, rgba(156, 175, 136, 0.1), rgba(184, 169, 201, 0.1))',
                                    border: '1px solid var(--accent-sage)',
                                    borderRadius: 'var(--radius-md)',
                                    padding: '12px 16px',
                                    marginBottom: '20px'
                                }}>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: journeysList.length > 0 ? '12px' : '0' }}>
                                        <span style={{ fontSize: '20px' }}>âœ¨</span>
                                        <span style={{ fontSize: '14px', color: 'var(--text-secondary)' }}>
                                            <strong>Creating New Journey</strong> â€” Choose a category to begin tracking!
                                        </span>
                                    </div>
                                    
                                    {/* Quick access to existing journeys */}
                                    {journeysList.length > 0 && (
                                        <div style={{ 
                                            borderTop: '1px solid rgba(0,0,0,0.06)', 
                                            paddingTop: '12px',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '8px',
                                            flexWrap: 'wrap'
                                        }}>
                                            <span style={{ fontSize: '12px', color: 'var(--text-muted)' }}>
                                                â†©ï¸ Go back to:
                                            </span>
                                            {journeysList.slice(0, 3).map(id => {
                                                const jData = getJourneyData(id);
                                                const name = jData?.journey?.goal?.substring(0, 15) || 'Journey';
                                                const icon = CATEGORIES[jData?.journey?.category]?.icon || 'ðŸ“‹';
                                                return (
                                                    <button
                                                        key={id}
                                                        onClick={() => handleSwitchJourney(id)}
                                                        style={{
                                                            background: 'white',
                                                            border: '1px solid var(--accent-sage)',
                                                            borderRadius: '20px',
                                                            padding: '4px 12px',
                                                            fontSize: '12px',
                                                            cursor: 'pointer',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            gap: '4px'
                                                        }}
                                                    >
                                                        {icon} {name}{name.length < (jData?.journey?.goal?.length || 0) ? '...' : ''}
                                                    </button>
                                                );
                                            })}
                                            {journeysList.length > 3 && (
                                                <span style={{ fontSize: '11px', color: 'var(--text-muted)' }}>
                                                    +{journeysList.length - 3} more (use dropdown)
                                                </span>
                                            )}
                                        </div>
                                    )}
                                </div>
                            )}
                            
                            {step === 'category' && (
                                <div>
                                    <CategorySelection onSelect={cat => { setSelectedCategory(cat); setStep('goal'); }} />
                                    
                                    {/* Backup Actions on category page */}
                                    <div style={{ marginTop: '24px' }}>
                                        <BackupActions data={data} onImport={handleImport} />
                                    </div>
                                </div>
                            )}
                            
                            {step === 'goal' && <GoalInput category={selectedCategory} onSubmit={handleGoalSubmit} onBack={() => setStep('category')} />}
                            
                            {step === 'dashboard' && data && <Dashboard data={data} onUpdate={setData} onReset={handleReset} />}
                            
                            {/* Backup Actions */}
                            {step === 'dashboard' && (
                                <div style={{ marginTop: '24px' }}>
                                    <BackupActions data={data} onImport={handleImport} />
                                </div>
                            )}
                            
                            {/* Footer with Social Share & Creator Info */}
                            <AppFooter 
                                userName={data?.userName} 
                                goal={data?.journey?.goal} 
                                milestones={data?.milestones || []}
                                category={data?.journey?.category}
                            />
                        </div>
                    </div>
                    
                    {/* RESET button - ALWAYS visible, only resets CURRENT journey */}
                    <button 
                        className="btn-secondary reset-btn" 
                        onClick={handleReset}
                        title={`Reset current journey: ${data?.journey?.goal || 'New Journey'}`}
                    >
                        ðŸ”„ Reset Journey
                    </button>
                </>
            );
        };
        
        console.log('All components defined, rendering App...');
        try {
            ReactDOM.createRoot(document.getElementById('root')).render(<App />);
            console.log('App rendered successfully!');
        } catch (e) {
            console.error('Error rendering App:', e);
            document.getElementById('root').innerHTML = '<div style="padding:40px;text-align:center;"><h2>Error Loading App</h2><p>' + e.message + '</p><button onclick="localStorage.clear();location.reload()">Clear Data & Reload</button></div>';
        }
    </script>
</body>
</html>

